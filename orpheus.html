<div class="background">
    <input type="radio" name="attr_tab" class="tab tab1" value="1" data-i18n-title="sheet" title="Sheet"
        checked="checked" />
    <input type="radio" name="attr_tab" class="tab tab2" value="2" data-i18n-title="horrors-items"
        title="Horrors/Items" />
    <input type="radio" name="attr_tab" class="tab tab3" value="3" title="Expanded Merits"
        data-i18n-title="expanded-merits" />
    <input type="radio" name="attr_tab" class="tab tab4" value="4" title="Background" data-i18n-title="background" />
    <input type="radio" name="attr_tab" class="tab tab5" value="5" title="Settings" data-i18n-title="settings" />
    <div class="tab-br"></div>
    <div class="diceroller">
        <input type="hidden" class="rollstyle" name="attr_rollstyle" value="sheet" />
        <input type="hidden" class="rolltype-select" name="attr_rolltype_select" value="normal" />
        <div class="diceroller-grid">
            <input id="collapsible" class="toggle" type="checkbox" name="attr_rolltoggle">
            <label for="collapsible" class="lbl-toggle subheader" data-i18n="dice-roller-u">DICE ROLLER</label>
            <div class="span collapsible-content">
                <button type="roll" class="inline-flex" name="roll_initiative"
                    value="&{template:wod-initiative} {{name=@{character_name}}} {{dexterity=@{dexterity}}} {{composure=@{composure}}} {{fastReflexesVal=@{fast_reflexes}}} {{fastReflexes=[[@{fast_reflexes}]]}} {{initiativePenaltyVal=@{initiative_penalty}}} {{initiativePenalty=[[@{initiative_penalty}]]}} {{initiativeBonusVal=@{initiative_bonus}}} {{initiativeBonus=[[@{initiative_bonus}]]}} {{shootFirst=[[@{shoot_first}]]}} {{firearms=@{firearms}}} {{result=[[1d10 + @{initiative} &{tracker}]]}}"
                    data-i18n="initiative">Initiative</button>
            </div>
            <div class="rollcontainer collapsible-content">
                <button type="action" name="act_roll"></button>
            </div>
            <div class="diceroller-options collapsible-content">
                <button type="action" class="toggle rollstyle-sheet" name="act_rollstyle_sheet"
                    data-i18n="sheet-roll">Sheet
                    Roll</button>
                <button type="action" class="toggle rollstyle-attack" name="act_rollstyle_attack"
                    data-i18n="attack-roll">Attack Roll</button>
                <button type="action" class="toggle rollstyle-simple" name="act_rollstyle_simple"
                    data-i18n="simple-roll">Simple Roll</button>
            </div>
            <div class="rolldisplay collapsible-content">
                <div class=" flex columns flex-center">
                    <textarea class="rollstyle sheet" name="attr_rolldisplay"></textarea>
                    <textarea class="rollstyle attack" name="attr_active_attack_name"></textarea>
                    <div class="rollstyle simple flex flex-center j-space-around">
                        <label for="attr_dice_pool" class="simple-roll" data-i18n="dice-tc">Dice</label>
                        <input type="number" id="attr_dice_pool" class="simple-roll" name="attr_dice_pool" />
                    </div>
                </div>
            </div>
            <div class="diceroller-options collapsible-content">
                <div class="flex rows">
                    <div class="flex columns">
                        <button type="action" class="toggle rolltype-normal" name="act_rolltype_select_normal"
                            data-i18n="normal">Normal</button>
                        <button type="action" class="toggle rolltype-9-again" name="act_rolltype_select_9-again"
                            data-i18n="9-again">9-Again</button>
                        <button type="action" class="toggle rolltype-8-again" name="act_rolltype_select_8-again"
                            data-i18n="8-again">8-Again</button>
                    </div>
                    <div class="horizontal-spacer"></div>
                    <div class="flex columns">
                        <input type="hidden" class="highlight-next" name="attr_rollmodify_rote" value="0" />
                        <button type="action" class="toggle rollmodify-rote" name="act_rollmodify_select_rote"
                            data-i18n="rote">Rote</button>
                        <input type="hidden" class="highlight-next" name="attr_rollmodify_willpower" value="0" />
                        <button type="action" class="toggle rollmodify-willpower rollstyle attack sheet" name="act_rollmodify_select_willpower"
                            data-i18n="willpower">Willpower</button>
                        <input type="hidden" class="highlight-next" name="attr_rollmodify_specialty" value="0" />
                        <button type="action" class="toggle rollmodify-specialty rollstyle attack sheet" name="act_rollmodify_select_specialty"
                            data-i18n="use-specialty">Use Specialty</button>
                    </div>
                </div>
            </div>
            <div class="diceroller-modifiers collapsible-content">
                <div class="flex">
                    <label for="rollmodify_modifier" data-i18n="modifiers" class="rollstyle attack sheet">Modifiers</label><input type="number"
                        class="rollstyle attack sheet" id="rollmodify_modifier" name="attr_rollmodify_modifier" value="0" />
                    <label for="rollreason" data-i18n="reason">Reason</label><input type="text" id="rollreason"
                        name="attr_rollreason" value="" />
                </div>
            </div>
        </div>
    </div>
    <div class="tab-content tab1">
        <div class="tabbed-panel">
            <div>
                <div class="info-grid">
                    <!-- Row 1 -->
                    <div class="input-label">
                        <span data-i18n="name">Name</span>:
                    </div>
                    <input type="text" name="attr_character_name">
                    <div class="spacer"></div>
                    <div class="input-label">
                        <span data-i18n="virtue">Virtue</span>:
                    </div>
                    <input type="text" name="attr_virtue">
                    <div class="spacer"></div>
                    <div class="input-label">
                        <span data-i18n="shade">Shade</span>:
                    </div>
                    <select name="attr_shade" class="select">
                        <option value="none" selected>---</option>
                        <option value="banshee" data-i18n="banshee">Banshee</option>
                        <option value="haunter" data-i18n="haunter">Haunter</option>
                        <option value="orphan_grinder" data-i18n="orphan-grinder">Orphan Grinder</option>
                        <option value="phantasm" data-i18n="phantasm">Phantasm</option>
                        <option value="poltergeist" data-i18n="poltergeist">Poltergeist</option>
                        <option value="skinrider" data-i18n="skinrider">Skinrider</option>
                        <option value="wisp" data-i18n="wisp">Wisp</option>
                        <option value="spectre" data-i18n="spectre">Spectre</option>
                    </select>
                    <!-- Row 2 -->
                    <div class="input-label">
                        <span data-i18n="player">Player</span>:
                    </div>
                    <input type="text" name="attr_player_name">
                    <div class="spacer"></div>
                    <div class="input-label">
                        <span data-i18n="vice">Vice</span>:
                    </div>
                    <input type="text" name="attr_vice">
                    <div class="spacer"></div>
                    <div class="input-label">
                        <span data-i18n="company">Company</span>:
                    </div>
                    <input type="text" name="attr_company">
                    <!-- Row 3 -->
                    <div class="input-label">
                        <span data-i18n="crucible">Crucible</span>:
                    </div>
                    <input type="text" name="attr_crucible">
                    <div class="spacer"></div>
                    <div class="input-label">
                        <span data-i18n="concept">Concept</span>:
                    </div>
                    <input type="text" name="attr_concept">
                    <div class="spacer"></div>
                    <div class="input-label">
                        <span data-i18n="lament">Lament</span>:
                    </div>
                    <select name="attr_lament" class="select">
                        <option value="none" selected>---</option>
                        <option value="skimmer" data-i18n="skimmer">Skimmer</option>
                        <option value="sleeper" data-i18n="sleeper">Sleeper</option>
                        <option value="spirit" data-i18n="spirit">Spirit</option>
                        <option value="hue" data-i18n="hue">Hue</option>
                    </select>
                </div>
                <div class="section-header">
                    <h2><span data-i18n="attributes-u">Attributes</span></h2>
                </div>
                <div class="attributes">
                    <div class="attributes-category power" data-i18n="power">Power</div>
                    <div class="attributes-category finesse" data-i18n="finesse">Finesse</div>
                    <div class="attributes-category resistance" data-i18n="resistance">Resistance</div>
                    <div class="mental border"></div>
                    <div class="power mental label">
                        <input type="hidden" class="flag" name="attr_intelligence_flag" value="0" />
                        <button type="action" class="toggle" name="act_intelligence"
                            data-i18n="intelligence">Intelligence</button>
                    </div>
                    <div class="power mental dots">
                        <input type="hidden" name="attr_intelligence" value="1" />
                        <button type="action" class="dot zero" name="act_intelligence-0">×</button>
                        <button type="action" class="dot" name="act_intelligence-1"></button>
                        <button type="action" class="dot ne-1" name="act_intelligence-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_intelligence-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_intelligence-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_intelligence-5"></button>
                    </div>
                    <div class="finesse mental label">
                        <input type="hidden" class="flag" name="attr_wits_flag" value="0" />
                        <button type="action" class="toggle" name="act_wits" data-i18n="wits">Wits</button>
                    </div>
                    <div class="finesse mental dots">
                        <input type="hidden" name="attr_wits" value="1" />
                        <button type="action" class="dot zero" name="act_wits-0">×</button>
                        <button type="action" class="dot" name="act_wits-1"></button>
                        <button type="action" class="dot ne-1" name="act_wits-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_wits-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_wits-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_wits-5"></button>
                    </div>
                    <div class="resistance mental label">
                        <input type="hidden" class="flag" name="attr_resolve_flag" value="0" />
                        <button type="action" class="toggle" name="act_resolve" data-i18n="resolve">Resolve</button>
                    </div>
                    <div class="resistance mental dots">
                        <input type="hidden" name="attr_resolve" value="1" />
                        <button type="action" class="dot zero" name="act_resolve-0">×</button>
                        <button type="action" class="dot" name="act_resolve-1"></button>
                        <button type="action" class="dot ne-1" name="act_resolve-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_resolve-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_resolve-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_resolve-5"></button>
                    </div>
                    <div class="physical border"></div>
                    <div class="power physical label">
                        <input type="hidden" class="flag" name="attr_strength_flag" value="0" />
                        <button type="action" class="toggle" name="act_strength" data-i18n="strength">Strength</button>
                    </div>
                    <div class="power physical dots">
                        <input type="hidden" name="attr_strength" value="1" />
                        <button type="action" class="dot zero" name="act_strength-0">×</button>
                        <button type="action" class="dot" name="act_strength-1"></button>
                        <button type="action" class="dot ne-1" name="act_strength-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_strength-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_strength-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_strength-5"></button>
                    </div>
                    <div class="finesse physical label">
                        <input type="hidden" class="flag" name="attr_dexterity_flag" value="0" />
                        <button type="action" class="toggle" name="act_dexterity"
                            data-i18n="dexterity">Dexterity</button>
                    </div>
                    <div class="finesse physical dots">
                        <input type="hidden" name="attr_dexterity" value="1" />
                        <button type="action" class="dot zero" name="act_dexterity-0">×</button>
                        <button type="action" class="dot" name="act_dexterity-1"></button>
                        <button type="action" class="dot ne-1" name="act_dexterity-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_dexterity-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_dexterity-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_dexterity-5"></button>
                    </div>
                    <div class="resistance physical label">
                        <input type="hidden" class="flag" name="attr_stamina_flag" value="0" />
                        <button type="action" class="toggle" name="act_stamina" data-i18n="stamina">Stamina</button>
                    </div>
                    <div class="resistance physical dots">
                        <input type="hidden" name="attr_stamina" value="1" />
                        <button type="action" class="dot zero" name="act_stamina-0">×</button>
                        <button type="action" class="dot" name="act_stamina-1"></button>
                        <button type="action" class="dot ne-1" name="act_stamina-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_stamina-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_stamina-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_stamina-5"></button>
                    </div>
                    <div class="social border"></div>
                    <div class="power social label">
                        <input type="hidden" class="flag" name="attr_presence_flag" value="0" />
                        <button type="action" class="toggle" name="act_presence" data-i18n="presence">Presence</button>
                    </div>
                    <div class="power social dots">
                        <input type="hidden" name="attr_presence" value="1" />
                        <button type="action" class="dot zero" name="act_presence-0">×</button>
                        <button type="action" class="dot" name="act_presence-1"></button>
                        <button type="action" class="dot ne-1" name="act_presence-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_presence-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_presence-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_presence-5"></button>
                    </div>
                    <div class="finesse social label">
                        <input type="hidden" class="flag" name="attr_manipulation_flag" value="0" />
                        <button type="action" class="toggle" name="act_manipulation"
                            data-i18n="manipulation">Manipulation</button>
                    </div>
                    <div class="finesse social dots">
                        <input type="hidden" name="attr_manipulation" value="1" />
                        <button type="action" class="dot zero" name="act_manipulation-0">×</button>
                        <button type="action" class="dot" name="act_manipulation-1"></button>
                        <button type="action" class="dot ne-1" name="act_manipulation-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_manipulation-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_manipulation-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_manipulation-5"></button>
                    </div>
                    <div class="resistance social label">
                        <input type="hidden" class="flag" name="attr_composure_flag" value="0" />
                        <button type="action" class="toggle" name="act_composure"
                            data-i18n="composure">Composure</button>
                    </div>
                    <div class="resistance social dots">
                        <input type="hidden" name="attr_composure" value="1" />
                        <button type="action" class="dot zero" name="act_composure-0">×</button>
                        <button type="action" class="dot" name="act_composure-1"></button>
                        <button type="action" class="dot ne-1" name="act_composure-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_composure-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_composure-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_composure-5"></button>
                    </div>
                </div>
                <div class="el_spacer"></div>
                <div class="flex">
                    <!-- SKILL FIELDS -->
                    <input type="hidden" class="widen-if" name="attr_enable_specialties">
                    <div class="skills">
                        <div class="section-header">
                            <h2><span data-i18n="skills-u">SKILLS</span></h2>
                        </div>
                        <div class="subheader">
                            <h3>Mental</h3>
                        </div>
                        <div class="subsubheader" data-i18n="unskilled-min3">(-3 unskilled)</div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag" name="attr_academics_box" value="0">
                                <button type="action" name="act_academics_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_academics_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_academics"
                                value="0">
                            <button type="action" class="toggle" name="act_academics"
                                data-i18n="academics">Academics</button><sup>(s)</sup>
                            <span>
                                <input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_academics">
                                </span>
                            </span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_academics" value="0" />
                            <button type="action" class="dot zero" name="act_academics-0">×</button>
                            <button type="action" class="dot" name="act_academics-1"></button>
                            <button type="action" class="dot ne-1" name="act_academics-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_academics-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_academics-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_academics-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox  eq-1">
                                <input type="hidden" class="flag" name="attr_computer_box" value="0">
                                <button type="action" name="act_computer_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_computer_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_computer"
                                value="0">
                            <button type="action" class="toggle" name="act_computer"
                                data-i18n="computer">Computer</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_computer">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_computer" value="0" />
                            <button type="action" class="dot zero" name="act_computer-0">×</button>
                            <button type="action" class="dot" name="act_computer-1"></button>
                            <button type="action" class="dot ne-1" name="act_computer-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_computer-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_computer-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_computer-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_crafts_box" value="0">
                                <button type="action" name="act_crafts_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_crafts_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_crafts"
                                value="0">
                            <button type="action" class="toggle" name="act_crafts"
                                data-i18n="crafts">Crafts</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_crafts">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_crafts" value="0" />
                            <button type="action" class="dot zero" name="act_crafts-0">×</button>
                            <button type="action" class="dot" name="act_crafts-1"></button>
                            <button type="action" class="dot ne-1" name="act_crafts-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_crafts-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_crafts-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_crafts-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox  eq-1">
                                <input type="hidden" class="flag" name="attr_investigation_box" value="0">
                                <button type="action" name="act_investigation_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_investigation_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_investigation"
                                value="0">
                            <button type="action" class="toggle" name="act_investigation"
                                data-i18n="investigation">Investigation</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_investigation">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_investigation" value="0" />
                            <button type="action" class="dot zero" name="act_investigation-0">×</button>
                            <button type="action" class="dot" name="act_investigation-1"></button>
                            <button type="action" class="dot ne-1" name="act_investigation-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_investigation-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_investigation-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_investigation-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_medicine_box" value="0">
                                <button type="action" name="act_medicine_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_medicine_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_medicine"
                                value="0">
                            <button type="action" class="toggle" name="act_medicine"
                                data-i18n="medicine">Medicine</button><sup>(s)</sup>
                            <span>
                                <input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_medicine">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_medicine" value="0" />
                            <button type="action" class="dot zero" name="act_medicine-0">×</button>
                            <button type="action" class="dot" name="act_medicine-1"></button>
                            <button type="action" class="dot ne-1" name="act_medicine-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_medicine-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_medicine-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_medicine-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_occult_box" value="0">
                                <button type="action" name="act_occult_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_occult_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_occult"
                                value="0">
                            <button type="action" class="toggle" name="act_occult"
                                data-i18n="occult">Occult</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_occult">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_occult" value="0" />
                            <button type="action" class="dot zero" name="act_occult-0">×</button>
                            <button type="action" class="dot" name="act_occult-1"></button>
                            <button type="action" class="dot ne-1" name="act_occult-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_occult-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_occult-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_occult-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_politics_box" value="0">
                                <button type="action" name="act_politics_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_politics_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_politics"
                                value="0">
                            <button type="action" class="toggle" name="act_politics"
                                data-i18n="politics">Politics</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_politics">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_politics" value="0" />
                            <button type="action" class="dot zero" name="act_politics-0">×</button>
                            <button type="action" class="dot" name="act_politics-1"></button>
                            <button type="action" class="dot ne-1" name="act_politics-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_politics-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_politics-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_politics-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_science_box" value="0">
                                <button type="action" name="act_science_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_science_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_science"
                                value="0">
                            <button type="action" class="toggle" name="act_science"
                                data-i18n="science">Science</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_science">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_science" value="0" />
                            <button type="action" class="dot zero" name="act_science-0">×</button>
                            <button type="action" class="dot" name="act_science-1"></button>
                            <button type="action" class="dot ne-1" name="act_science-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_science-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_science-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_science-5"></button>
                        </div>
                        <div class="subheader">
                            <h3>Physical</h3>
                        </div>
                        <div class="subsubheader">(-1 unskilled)</div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_athletics_box" value="0">
                                <button type="action" name="act_athletics_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_athletics_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_athletics"
                                value="0">
                            <button type="action" class="toggle" name="act_athletics"
                                data-i18n="athletics">Athletics</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_athletics">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_athletics" value="0" />
                            <button type="action" class="dot zero" name="act_athletics-0">×</button>
                            <button type="action" class="dot" name="act_athletics-1"></button>
                            <button type="action" class="dot ne-1" name="act_athletics-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_athletics-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_athletics-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_athletics-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_brawl_box" value="0">
                                <button type="action" name="act_brawl_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_brawl_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_brawl"
                                value="0">
                            <button type="action" class="toggle" name="act_brawl"
                                data-i18n="brawl">Brawl</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_brawl">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_brawl" value="0" />
                            <button type="action" class="dot zero" name="act_brawl-0">×</button>
                            <button type="action" class="dot" name="act_brawl-1"></button>
                            <button type="action" class="dot ne-1" name="act_brawl-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_brawl-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_brawl-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_brawl-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_drive_box" value="0">
                                <button type="action" name="act_drive_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_drive_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_drive"
                                value="0">
                            <button type="action" class="toggle" name="act_drive"
                                data-i18n="drive">Drive</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_drive">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_drive" value="0" />
                            <button type="action" class="dot zero" name="act_drive-0">×</button>
                            <button type="action" class="dot" name="act_drive-1"></button>
                            <button type="action" class="dot ne-1" name="act_drive-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_drive-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_drive-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_drive-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_firearms_box" value="0">
                                <button type="action" name="act_firearms_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_firearms_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_firearms"
                                value="0">
                            <button type="action" class="toggle" name="act_firearms"
                                data-i18n="firearms">Firearms</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_firearms">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_firearms" value="0" />
                            <button type="action" class="dot zero" name="act_firearms-0">×</button>
                            <button type="action" class="dot" name="act_firearms-1"></button>
                            <button type="action" class="dot ne-1" name="act_firearms-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_firearms-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_firearms-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_firearms-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_larceny_box" value="0">
                                <button type="action" name="act_larceny_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_larceny_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_larceny"
                                value="0">
                            <button type="action" class="toggle" name="act_larceny"
                                data-i18n="larceny">Larceny</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_larceny">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_larceny" value="0" />
                            <button type="action" class="dot zero" name="act_larceny-0">×</button>
                            <button type="action" class="dot" name="act_larceny-1"></button>
                            <button type="action" class="dot ne-1" name="act_larceny-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_larceny-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_larceny-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_larceny-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_stealth_box" value="0">
                                <button type="action" name="act_stealth_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_stealth_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_stealth"
                                value="0">
                            <button type="action" class="toggle" name="act_stealth"
                                data-i18n="stealth">Stealth</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_stealth">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_stealth" value="0" />
                            <button type="action" class="dot zero" name="act_stealth-0">×</button>
                            <button type="action" class="dot" name="act_stealth-1"></button>
                            <button type="action" class="dot ne-1" name="act_stealth-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_stealth-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_stealth-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_stealth-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_survival_box" value="0">
                                <button type="action" name="act_survival_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_survival_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_survival"
                                value="0">
                            <button type="action" class="toggle" name="act_survival"
                                data-i18n="survival">Survival</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_survival">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_survival" value="0" />
                            <button type="action" class="dot zero" name="act_survival-0">×</button>
                            <button type="action" class="dot" name="act_survival-1"></button>
                            <button type="action" class="dot ne-1" name="act_survival-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_survival-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_survival-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_survival-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_weaponry_box" value="0">
                                <button type="action" name="act_weaponry_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_weaponry_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_weaponry"
                                value="0">
                            <button type="action" class="toggle" name="act_weaponry"
                                data-i18n="weaponry">Weaponry</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_weaponry">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_weaponry" value="0" />
                            <button type="action" class="dot zero" name="act_weaponry-0">×</button>
                            <button type="action" class="dot" name="act_weaponry-1"></button>
                            <button type="action" class="dot ne-1" name="act_weaponry-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_weaponry-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_weaponry-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_weaponry-5"></button>
                        </div>
                        <div class="subheader">
                            <h3>Social</h3>
                        </div>
                        <div class="subsubheader">(-1 unskilled)</div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_animalken_box" value="0">
                                <button type="action" name="act_animalken_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_animalken_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_animalken"
                                value="0">
                            <button type="action" class="toggle" name="act_animalken" data-i18n="animalken">Animal
                                Ken</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_animalken">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_animalken" value="0" />
                            <button type="action" class="dot zero" name="act_animalken-0">×</button>
                            <button type="action" class="dot" name="act_animalken-1"></button>
                            <button type="action" class="dot ne-1" name="act_animalken-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_animalken-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_animalken-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_animalken-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_empathy_box" value="0">
                                <button type="action" name="act_empathy_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_empathy_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_empathy"
                                value="0">
                            <button type="action" class="toggle" name="act_empathy"
                                data-i18n="empathy">Empathy</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_empathy">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_empathy" value="0" />
                            <button type="action" class="dot zero" name="act_empathy-0">×</button>
                            <button type="action" class="dot" name="act_empathy-1"></button>
                            <button type="action" class="dot ne-1" name="act_empathy-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_empathy-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_empathy-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_empathy-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_expression_box" value="0">
                                <button type="action" name="act_expression_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_expression_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_expression"
                                value="0">
                            <button type="action" class="toggle" name="act_expression"
                                data-i18n="expression">Expression</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_expression">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_expression" value="0" />
                            <button type="action" class="dot zero" name="act_expression-0">×</button>
                            <button type="action" class="dot" name="act_expression-1"></button>
                            <button type="action" class="dot ne-1" name="act_expression-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_expression-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_expression-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_expression-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_intimidation_box" value="0">
                                <button type="action" name="act_intimidation_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_intimidation_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_intimidation"
                                value="0">
                            <button type="action" class="toggle" name="act_intimidation"
                                data-i18n="intimidation">Intimidation</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_intimidation">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_intimidation" value="0" />
                            <button type="action" class="dot zero" name="act_intimidation-0">×</button>
                            <button type="action" class="dot" name="act_intimidation-1"></button>
                            <button type="action" class="dot ne-1" name="act_intimidation-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_intimidation-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_intimidation-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_intimidation-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_persuasion_box" value="0">
                                <button type="action" name="act_persuasion_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_persuasion_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_persuasion"
                                value="0">
                            <button type="action" class="toggle" name="act_persuasion"
                                data-i18n="persuasion">Persuasion</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_persuasion">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_persuasion" value="0" />
                            <button type="action" class="dot zero" name="act_persuasion-0">×</button>
                            <button type="action" class="dot" name="act_persuasion-1"></button>
                            <button type="action" class="dot ne-1" name="act_persuasion-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_persuasion-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_persuasion-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_persuasion-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_socialize_box" value="0">
                                <button type="action" name="act_socialize_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_socialize_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_socialize"
                                value="0">
                            <button type="action" class="toggle" name="act_socialize"
                                data-i18n="socialize">Socialize</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_socialize">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_socialize" value="0" />
                            <button type="action" class="dot zero" name="act_socialize-0">×</button>
                            <button type="action" class="dot" name="act_socialize-1"></button>
                            <button type="action" class="dot ne-1" name="act_socialize-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_socialize-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_socialize-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_socialize-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_streetwise_box" value="0">
                                <button type="action" name="act_streetwise_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_streetwise_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_streetwise"
                                value="0">
                            <button type="action" class="toggle" name="act_streetwise"
                                data-i18n="streetwise">Streetwise</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_streetwise">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_streetwise" value="0" />
                            <button type="action" class="dot zero" name="act_streetwise-0">×</button>
                            <button type="action" class="dot" name="act_streetwise-1"></button>
                            <button type="action" class="dot ne-1" name="act_streetwise-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_streetwise-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_streetwise-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_streetwise-5"></button>
                        </div>
                        <div>
                            <input type="hidden" class="if" name="attr_enable_profession">
                            <span class="checkbox eq-1">
                                <input type="hidden" class="flag " name="attr_subterfuge_box" value="0">
                                <button type="action" name="act_subterfuge_box"></button>
                            </span>
                            <input type="hidden" class="flag" name="attr_subterfuge_flag" value="0" />
                            <input type="hidden" class="if-has-specialty" name="attr_has_specialization_subterfuge"
                                value="0">
                            <button type="action" class="toggle" name="act_subterfuge"
                                data-i18n="subterfuge">Subterfuge</button><sup>(s)</sup>
                            <span><input type="hidden" class="if" name="attr_enable_specialties">
                                <span class="eq-1 skill_specialty">
                                    <input type="text" name="attr_specialization_subterfuge">
                                </span></span>
                        </div>
                        <div class="dots">
                            <input type="hidden" name="attr_subterfuge" value="0" />
                            <button type="action" class="dot zero" name="act_subterfuge-0">×</button>
                            <button type="action" class="dot" name="act_subterfuge-1"></button>
                            <button type="action" class="dot ne-1" name="act_subterfuge-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_subterfuge-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_subterfuge-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_subterfuge-5"></button>
                        </div>
                    </div>
                    <div class="horizontal-spacer"></div>
                    <!-- OTHER TRAITS -->
                    <div class="grow">
                        <div class="section-header">
                            <h2><span data-i18n="other-traits-u">Other Traits</span></h2>
                        </div>
                        <div class="flex">
                            <div class="grow">
                                <div class="columns">
                                    <!-- MERITS -->
                                    <div>
                                        <div class="subheader">
                                            <h3><span data-i18n="merits">Merits</span></h3>
                                        </div>
                                        <fieldset class="repeating_merit">
                                            <div class="sheet-input-group">
                                                <input type="text" name="attr_merit_name" />
                                                <div class="dots">
                                                    <input type="hidden" name="attr_merit" value="0">
                                                    <button type="action" class="dot zero"
                                                        name="act_merit-0">&times;</button>
                                                    <button type="action" class="dot" name="act_merit-1"></button>
                                                    <button type="action" class="dot ne-1" name="act_merit-2"></button>
                                                    <button type="action" class="dot ne-1 ne-2"
                                                        name="act_merit-3"></button>
                                                    <button type="action" class="dot ne-1 ne-2 ne-3"
                                                        name="act_merit-4"></button>
                                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4"
                                                        name="act_merit-5"></button>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div class="columns">
                                    <div>
                                        <div class="subheader">
                                            <h3 data-i18n="horrors">Horrors</h3>
                                        </div>
                                        <fieldset class="repeating_horror">
                                            <div class="sheet-input-group">
                                                <input type="text" name="attr_horrorf" />
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="horizontal-spacer"></div>
                                    <div>
                                        <div class="subheader">
                                            <h3 data-i18n="stains">Stains</h3>
                                        </div>
                                        <fieldset class="repeating_stain">
                                            <div class="sheet-input-group">
                                                <input type="text" name="attr_stain" />
                                            </div>
                                        </fieldset>
                                    </div>
                                </div>
                                <div>
                                    <div class="el_spacer"></div>
                                    <div class="subheader">
                                        <h3 data-i18n="weapons">Weapons</h3>
                                    </div>
                                    <input type="hidden" name="attr_selected_attack" value="0" />
                                    <div class="weapongrid">
                                        <div></div>
                                        <div data-i18n="weapon-attack">Weapon/Attack</div>
                                        <div data-i18n="type">Type</div>
                                        <div data-type="damage-short">Dmg</div>
                                        <div></div>
                                        <div data-i18n="range-short">Rng</div>
                                        <div data-i18n="magazine-short">Mag</div>
                                        <div data-i18n="initiative-short">Ini</div>
                                        <div data-i18n="strength-short">Str</div>
                                        <div data-i18n="size-short">Sz</div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_0_flag" value="1">
                                            <button type="action" class="radio" name="act_attack_0"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_0_flag" value="1">
                                            <input type="text" name="attr_attack_name0" class="toggle" disabled="disabled" value="@{unarmedmacro}" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type0">
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage0" value="0" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type0">
                                                <option value="bashing" data-i18n="bashing-short">Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short">Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short">Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range0" disabled="disabled" value="-" />
                                        </div>
                                        <div><input type="text" name="attr_attack_magazine0" disabled="disabled" value="-" />
                                        </div>
                                        <div><input type="text" name="attr_attack_initiative0" disabled="disabled" value="0" />
                                        </div>
                                        <div><input type="text" name="attr_attack_strength0" disabled="disabled" value="0" />
                                        </div>
                                        <div><input type="text" name="attr_attack_size0" disabled="disabled" value="-" />
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_1_flag" value="0">
                                            <button type="action" class="radio" name="act_attack_1"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_1_flag">
                                            <input type="text" name="attr_attack_name1" class="toggle" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type1">
                                                <option value="" checked="checked"></option>
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage1" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type1">
                                                <option value="bashing" data-i18n="bashing-short"> Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short"> Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short"> Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range1" /></div>
                                        <div><input type="text" name="attr_attack_magazine1" /></div>
                                        <div><input type="text" name="attr_attack_initiative1" /></div>
                                        <div><input type="text" name="attr_attack_strength1" /></div>
                                        <div><input type="text" name="attr_attack_size1" /></div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_2_flag" value="0">
                                            <button type="action" class="radio" name="act_attack_2"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_2_flag">
                                            <input type="text" name="attr_attack_name2"
                                                class="weaponstat name toggle" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type2">
                                                <option value="" checked="checked">
                                                </option>
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage2" class="weaponstat" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type2">
                                                <option value="bashing" data-i18n="bashing-short"> Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short"> Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short"> Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range2" class="weaponstat range" />
                                        </div>
                                        <div><input type="text" name="attr_attack_magazine2" class="weaponstat mag" />
                                        </div>
                                        <div><input type="text" name="attr_attack_initiative2" class="weaponstat" />
                                        </div>
                                        <div><input type="text" name="attr_attack_strength2" class="weaponstat" /></div>
                                        <div><input type="text" name="attr_attack_size2" class="weaponstat" /></div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_3_flag" value="0">
                                            <button type="action" class="radio" name="act_attack_3"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_3_flag">
                                            <input type="text" name="attr_attack_name3"
                                                class="weaponstat name toggle" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type3">
                                                <option value="" checked="checked">
                                                </option>
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage3" class="weaponstat" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type3">
                                                <option value="bashing" data-i18n="bashing-short"> Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short"> Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short"> Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range3" class="weaponstat range" />
                                        </div>
                                        <div><input type="text" name="attr_attack_magazine3" class="weaponstat mag" />
                                        </div>
                                        <div><input type="text" name="attr_attack_initiative3" class="weaponstat" />
                                        </div>
                                        <div><input type="text" name="attr_attack_strength3" class="weaponstat" /></div>
                                        <div><input type="text" name="attr_attack_size3" class="weaponstat" /></div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_4_flag" value="0">
                                            <button type="action" class="radio" name="act_attack_4"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_4_flag">
                                            <input type="text" name="attr_attack_name4"
                                                class="weaponstat name toggle" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type4">
                                                <option value="" checked="checked">
                                                </option>
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage4" class="weaponstat" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type4">
                                                <option value="bashing" data-i18n="bashing-short"> Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short"> Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short"> Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range4" class="weaponstat range" />
                                        </div>
                                        <div><input type="text" name="attr_attack_magazine4" class="weaponstat mag" />
                                        </div>
                                        <div><input type="text" name="attr_attack_initiative4" class="weaponstat" />
                                        </div>
                                        <div><input type="text" name="attr_attack_strength4" class="weaponstat" /></div>
                                        <div><input type="text" name="attr_attack_size4" class="weaponstat" /></div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_5_flag" value="0">
                                            <button type="action" class="radio" name="act_attack_5"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_5_flag">
                                            <input type="text" name="attr_attack_name5"
                                                class="weaponstat name toggle" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type5">
                                                <option value="" checked="checked">
                                                </option>
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage5" class="weaponstat" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type5">
                                                <option value="bashing" data-i18n="bashing-short"> Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short"> Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short"> Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range5" class="weaponstat range" />
                                        </div>
                                        <div><input type="text" name="attr_attack_magazine5" class="weaponstat mag" />
                                        </div>
                                        <div><input type="text" name="attr_attack_initiative5" class="weaponstat" />
                                        </div>
                                        <div><input type="text" name="attr_attack_strength5" class="weaponstat" /></div>
                                        <div><input type="text" name="attr_attack_size5" class="weaponstat" /></div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_6_flag" value="0">
                                            <button type="action" class="radio" name="act_attack_6"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_attack_6_flag">
                                            <input type="text" name="attr_attack_name6"
                                                class="weaponstat name toggle" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type6">
                                                <option value="" checked="checked">
                                                </option>
                                                <option value="brawl" data-i18n="brawl"> Brawl</option>
                                                <option value="melee" data-i18n="melee"> Melee</option>
                                                <option value="gun" data-i18n="gun"> Gun</option>
                                                <option value="thrown" data-i18n="thrown"> Thrown</option>
                                                <option value="brawl-fight-finesse" data-i18n="brawl-fight-finesse"> Brawl* (Fighting Finesse)</option>
                                                <option value="melee-fight-finesse" data-i18n="melee-fight-finesse"> Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage6" class="weaponstat" /></div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_damage_type6">
                                                <option value="bashing" data-i18n="bashing-short"> Bashing</option>
                                                <option value="lethal" data-i18n="lethal-short"> Lethal</option>
                                                <option value="aggravated" data-i18n="aggravated-short"> Aggravated</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_range6" class="weaponstat range" />
                                        </div>
                                        <div><input type="text" name="attr_attack_magazine6" class="weaponstat mag" />
                                        </div>
                                        <div><input type="text" name="attr_attack_initiative6" class="weaponstat" />
                                        </div>
                                        <div><input type="text" name="attr_attack_strength6" class="weaponstat" /></div>
                                        <div><input type="text" name="attr_attack_size6" class="weaponstat" /></div>
                                    </div>
                                    <div class="el_spacer"></div>
                                    <div class="subheader">
                                        <h3 data-i18n="armor">Armor</h3>
                                    </div>
                                    <div class="armorgrid">
                                        <div></div>
                                        <div data-i18n="armor">Armor</div>
                                        <div data-i18n="rating">Rating</div>
                                        <div data-i18n="strength-short">Str</div>
                                        <div data-i18n="defense-short">Def</div>
                                        <div data-i18n="speed-short">Spd</div>
                                        <div data-i18n="description">Description</div>
                                        <div class="checkbox">
                                            <input type="hidden" name="attr_armor_flag0">
                                            <button type="action" name="act_armor_flag0"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_armor_flag0" value="0">
                                            <input type="text" class="toggle" name="attr_armor_name0" />
                                        </div>
                                        <div><input type="text" name="attr_armor_ballistic0" />/<input type="text"
                                                name="attr_armor_general0" /></div>
                                        <div><input type="text" name="attr_armor_strength0" /></div>
                                        <div><input type="text" name="attr_armor_defense0" /></div>
                                        <div><input type="text" name="attr_armor_speed0" /></div>
                                        <div><input type="text" name="attr_armor_description0" /></div>
                                        <div class="checkbox">
                                            <input type="hidden" name="attr_armor_flag1">
                                            <button type="action" name="act_armor_flag1"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_armor_flag1" value="0">
                                            <input type="text" class="toggle" name="attr_armor_name1" />
                                        </div>
                                        <div><input type="text" name="attr_armor_ballistic1" />/<input type="text"
                                                name="attr_armor_general1" /></div>
                                        <div><input type="text" name="attr_armor_strength1" /></div>
                                        <div><input type="text" name="attr_armor_defense1" /></div>
                                        <div><input type="text" name="attr_armor_speed1" /></div>
                                        <div><input type="text" name="attr_armor_description1" /></div>
                                        <div class="checkbox">
                                            <input type="hidden" name="attr_armor_flag2">
                                            <button type="action" name="act_armor_flag2"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_armor_flag2" value="0">
                                            <input type="text" class="toggle" name="attr_armor_name2" />
                                        </div>
                                        <div><input type="text" name="attr_armor_ballistic2" />/<input type="text"
                                                name="attr_armor_general2" /></div>
                                        <div><input type="text" name="attr_armor_strength2" /></div>
                                        <div><input type="text" name="attr_armor_defense2" /></div>
                                        <div><input type="text" name="attr_armor_speed2" /></div>
                                        <div><input type="text" name="attr_armor_description2" /></div>
                                        <div class="checkbox">
                                            <input type="hidden" name="attr_armor_flag3">
                                            <button type="action" name="act_armor_flag3"></button>
                                        </div>
                                        <div>
                                            <input type="hidden" class="flag" name="attr_armor_flag3" value="0">
                                            <input type="text" class="toggle" name="attr_armor_name3" />
                                        </div>
                                        <div><input type="text" name="attr_armor_ballistic3" />/<input type="text"
                                                name="attr_armor_general3" /></div>
                                        <div><input type="text" name="attr_armor_strength3" /></div>
                                        <div><input type="text" name="attr_armor_defense3" /></div>
                                        <div><input type="text" name="attr_armor_speed3" /></div>
                                        <div><input type="text" name="attr_armor_description3" /></div>
                                    </div>
                                </div>
                            </div>
                            <div class="horizontal-spacer"></div>
                            <div>
                                <input type="hidden" name="attr_lament" class="lament-if" value="" />
                                <div class="ne-hue ne-spirit">
                                    <div class="flex rows flex-center">
                                        <div class="subheader">
                                            <button type="action" class="toggle" name="act_projected"
                                                data-i18n="project">Project</button>
                                        </div>
                                        <span class="checkbox">
                                            <input type="hidden" class="flag" name="attr_projected" value="0">
                                            <button type="action" name="act_projected"></button>
                                        </span>
                                    </div>
                                    <div class="el_spacer"></div>
                                    <div class="subheader">
                                        <h3 data-i18n="health">Health</h3>
                                    </div>
                                    <div>
                                        <div class="healthboxes">
                                            <input type="hidden" name="attr_health" class="if" value="0" />
                                            <div class="healthbox ne-0">
                                                <input type="hidden" name="attr_healthbox_1" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_1"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1">
                                                <input type="hidden" name="attr_healthbox_2" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_2"></button>
                                            </div>
                                            <div class="healthbox ne-1 ne-2">
                                                <input type="hidden" name="attr_healthbox_3" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_3"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3">
                                                <input type="hidden" name="attr_healthbox_4" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_4"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4">
                                                <input type="hidden" name="attr_healthbox_5" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_5"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5">
                                                <input type="hidden" name="attr_healthbox_6" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_6"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6">
                                                <input type="hidden" name="attr_healthbox_7" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_7"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7">
                                                <input type="hidden" name="attr_healthbox_8" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_8"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8">
                                                <input type="hidden" name="attr_healthbox_9" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_9"></button>
                                            </div>
                                            <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9">
                                                <input type="hidden" name="attr_healthbox_10" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_10"></button>
                                            </div>
                                            <div
                                                class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10">
                                                <input type="hidden" name="attr_healthbox_11" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_11"></button>
                                            </div>
                                            <div
                                                class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11">
                                                <input type="hidden" name="attr_healthbox_12" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_12"></button>
                                            </div>
                                            <div
                                                class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12">
                                                <input type="hidden" name="attr_healthbox_13" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_13"></button>
                                            </div>
                                            <div
                                                class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13">
                                                <input type="hidden" name="attr_healthbox_14" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_14"></button>
                                            </div>
                                            <div
                                                class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14">
                                                <input type="hidden" name="attr_healthbox_15" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_15"></button>
                                            </div>
                                            <div
                                                class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14 ne-15">
                                                <input type="hidden" name="attr_healthbox_16" value="0" />
                                                <button type="action" class="damage" name="act_healthbox_16"></button>
                                            </div>
                                        </div>
                                        <div class="dots">
                                            <input type="hidden" name="attr_health" class="if" />
                                            <div
                                                class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14 ne-15">
                                            </div>
                                            <div
                                                class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14">
                                            </div>
                                            <div
                                                class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13">
                                            </div>
                                            <div
                                                class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12">
                                            </div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11">
                                            </div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10">
                                            </div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9">
                                            </div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8"></div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7"></div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6"></div>
                                            <div class="healthbox ne-2 ne-3 ne-4 ne-5"></div>
                                            <div class="healthbox ne-2 ne-3 ne-4"></div>
                                            <div class="healthbox ne-2 ne-3"></div>
                                            <span class="healthbox ne-2" name="attr_wound_penalty_1">-1</span>
                                            <span class="healthbox" name="attr_wound_penalty_2">-2</span>
                                            <span class="healthbox" name="attr_wound_penalty_3">-3</span>
                                        </div>
                                    </div>
                                    <div class="el_spacer"></div>
                                </div>
                                <div>
                                    <div class="subheader">
                                        <h3 data-i18n="willpower">Willpower</h3>
                                    </div>
                                    <div class="checkboxes">
                                        <input type="hidden" name="attr_willpower" class="if" value="0" />
                                        <input type="hidden" name="attr_current_willpower" class="checked-if"
                                            value="0" />
                                        <div class="checkbox ne-0 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2 ge-1">
                                            <button type="action" name="act_willpower_box1"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2">
                                            <button type="action" name="act_willpower_box2"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3">
                                            <button type="action" name="act_willpower_box3"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4">
                                            <button type="action" name="act_willpower_box4"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5">
                                            <button type="action" name="act_willpower_box5"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ge-10 ge-9 ge-8 ge-7 ge-6">
                                            <button type="action" name="act_willpower_box6"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ge-10 ge-9 ge-8 ge-7">
                                            <button type="action" name="act_willpower_box7"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ge-10 ge-9 ge-8">
                                            <button type="action" name="act_willpower_box8"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ge-10 ge-9">
                                            <button type="action" name="act_willpower_box9"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ge-10">
                                            <button type="action" name="act_willpower_box10"></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="el-spacer"></div>
                                <input type="hidden" name="attr_shade" class="shade-if" value="spectre" />
                                <div class="ne-spectre ne-mortal">
                                    <div class="subheader">
                                        <h3 data-i18n="vitality">Vitality</h3>
                                    </div>
                                    <div class="checkboxes">
                                        <input type="hidden" name="attr_vitality" class="highlighted-if" value="" />
                                        <input type="hidden" name="attr_current_vitality" class="checked-if"
                                            value="0" />
                                        <input type="hidden" name="attr_lament" class="lament-if" value="hue" />
                                        <input type="hidden" name="attr_luminous" class="luminous-if" value="0" />
                                        <div
                                            class="checkbox ne-0 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2 ge-1">
                                            <button type="action" name="act_vitality_box1"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2">
                                            <button type="action" name="act_vitality_box2"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3">
                                            <button type="action" name="act_vitality_box3"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4">
                                            <button type="action" name="act_vitality_box4"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5">
                                            <button type="action" name="act_vitality_box5"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6">
                                            <button type="action" name="act_vitality_box6"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7">
                                            <button type="action" name="act_vitality_box7"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ne-hue">
                                            <button type="action" name="act_vitality_box8"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ne-hue">
                                            <button type="action" name="act_vitality_box9"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ne-hue">
                                            <button type="action" name="act_vitality_box10"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ge-15 ge-14 ge-13 ge-12 ge-11 ne-hue luminous ne-luminous-0">
                                            <button type="action" name="act_vitality_box11"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ge-15 ge-14 ge-13 ge-12 ne-hue luminous ne-luminous-0 ne-luminous-1">
                                            <button type="action" name="act_vitality_box12"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12  ge-15 ge-14 ge-13 ne-hue luminous ne-luminous-0 ne-luminous-1 ne-luminous-2">
                                            <button type="action" name="act_vitality_box13"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ge-15 ge-14 ne-hue luminous ne-luminous-0 ne-luminous-1 ne-luminous-2 ne-luminous-3">
                                            <button type="action" name="act_vitality_box14"></button>
                                        </div>
                                        <div
                                            class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9  ne-10 ne-11 ne-12 ne-13 ne-14 ge-15 luminous ne-luminous-0 ne-luminous-1 ne-luminous-2 ne-luminous-3 ne-luminous-4">
                                            <button type="action" name="act_vitality_box15"></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="el_spacer"></div>
                                <input type="hidden" name="attr_shade" class="shade-if" value="spectre" />
                                <div class="ne-mortal">
                                    <div class="subheader">
                                        <h3 data-i18n="spite">Spite</h3>
                                    </div>
                                    <div class="healthboxes">
                                        <input type="hidden" name="attr_spite" />
                                        <button type="action" class="dot zero" name="act_spite-0">×</button>
                                        <button type="action" class="dot" name="act_spite-1"></button>
                                        <button type="action" class="dot ne-1" name="act_spite-2"></button>
                                        <button type="action" class="dot ne-1 ne-2" name="act_spite-3"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_spite-4"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4"
                                            name="act_spite-5"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5"
                                            name="act_spite-6"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6"
                                            name="act_spite-7"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7"
                                            name="act_spite-8"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8"
                                            name="act_spite-9"></button>
                                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9"
                                            name="act_spite-10"></button>
                                        <button type="action" class="dot zero" name="act_spite-0">×</button>
                                    </div>
                                    <div class="checkboxes">
                                        <input type="hidden" name="attr_current_spite" class="checked-if" value="0" />
                                        <div class="checkbox ne-0 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2 ge-1">
                                            <button type="action" name="act_spite_box1"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2">
                                            <button type="action" name="act_spite_box2"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3">
                                            <button type="action" name="act_spite_box3"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4">
                                            <button type="action" name="act_spite_box4"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5">
                                            <button type="action" name="act_spite_box5"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ge-10 ge-9 ge-8 ge-7 ge-6">
                                            <button type="action" name="act_spite_box6"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ge-10 ge-9 ge-8 ge-7">
                                            <button type="action" name="act_spite_box7"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ge-10 ge-9 ge-8">
                                            <button type="action" name="act_spite_box8"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ge-10 ge-9">
                                            <button type="action" name="act_spite_box9"></button>
                                        </div>
                                        <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ge-10">
                                            <button type="action" name="act_spite_box10"></button>
                                        </div>
                                    </div>
                                </div>
                                <div class="el-spacer"></div>
                                <div>
                                    <div class="subheader">
                                        <h3 data-i18n="derived">Derived</h3>
                                    </div>
                                    <div class="derived">
                                        <span data-i18n="size">Size</span>:<input type="number" name="attr_size"
                                            value="@{base_size}+@{giant}-@{small_framed}" disabled="disabled" />
                                    </div>
                                    <div class="derived">
                                        <span data-i18n="speed">Speed</span>:<input type="number" name="attr_speed"
                                            value="@{species_factor}+@{speed_base}+@{speed_penalty}+@{fleet_of_foot}"
                                            disabled="disabled" />
                                    </div>
                                    <div class="derived">
                                        <span data-i18n="defense">Defense</span>:<input type="number"
                                            name="attr_defense" value="@{defense_base}+@{defense_penalty}"
                                            disabled="disabled" />
                                    </div>
                                    <div class="derived">
                                        <span data-i18n="armor">Armor</span>:<input type="number"
                                            name="attr_balistic_armor_display" value="@{balistic_armor}"
                                            disabled="disabled" />/<input type="number"
                                            name="attr_general_armor_display" value="@{general_armor}"
                                            disabled="disabled" />
                                    </div>
                                    <div class="derived">
                                        <span data-i18n="initiative">Initiative</span>:<input type="number"
                                            name="attr_initiative"
                                            value="@{initiative_base}+@{initiative_penalty}+@{fast_reflexes}+@{shoot_first_bonus}+@{initiative_bonus}"
                                            disabled="disabled" />
                                    </div>
                                </div>
                                <div class="sheet-input-group">
                                    <span data-i18n="experience">Experience</span>
                                    <span>:</span>
                                    <input type="text" name="attr_experience">
                                </div>
                                <div>
                                    <div class="subheader">
                                        <h5><span data-i18n="aspirations">Aspirations</span></h5>
                                    </div>
                                    <div class="textboxes">
                                        <input type="text" name="attr_aspirations"><br>
                                        <input type="text" name="attr_aspirations2"><br>
                                        <input type="text" name="attr_aspirations3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-content tab2">
        <div class="tabbed-panel">
            <div class="section-header">
                <h2><span data-i18n="extra-traits">Extra Traits</span></h2>
            </div>
            <div class="columns">
                <div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_1_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_1" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_1-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_1-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_1-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_1-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_1-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_1-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_2_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_2" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_2-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_2-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_2-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_2-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_2-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_2-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_3_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_3" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_3-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_3-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_3-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_3-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_3-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_3-5"></button>
                        </div>
                    </div>
                </div>
                <div class="horizontal-spacer"></div>
                <div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_4_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_4" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_4-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_4-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_4-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_4-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_4-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_4-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_5_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_5" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_5-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_5-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_5-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_5-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_5-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_5-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_6_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_6" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_6-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_6-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_6-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_6-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_6-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_6-5"></button>
                        </div>
                    </div>
                </div>
                <div class="horizontal-spacer"></div>
                <div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_7_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_7" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_7-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_7-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_7-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_7-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_7-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_7-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_8_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_8" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_8-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_8-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_8-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_8-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_8-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_8-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_extra_trait_9_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_extra_trait_9" value="0">
                            <button type="action" class="dot zero" name="act_extra_trait_9-0">&times;</button>
                            <button type="action" class="dot" name="act_extra_trait_9-1"></button>
                            <button type="action" class="dot ne-1" name="act_extra_trait_9-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_9-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_9-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_9-5"></button>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <div class="subheader">
                    <h2><span data-i18n="horror-usage">Horror Usage</span></h2>
                </div>
                <div class="sheet-2colrow">
                    <div class="sheet-col">
                        <table class="devotions" style="width:100%">
                            <tr class="horror_use_desc">
                                <td data-i18n="horror">Horror</td>
                                <td><input type="text" name="attr_horror_name_1" /></td>
                                <td data-i18n="cost">Cost</td>
                                <td><input type="text" name="attr_horror_cost_1" /><br></td>
                            </tr>
                            <tr>
                                <td colspan="4"><textarea name="attr_horror_use_text_1" rows="3" wrap="soft"
                                        style="width:97%" placeholder="Description"></textarea></td>
                            </tr>
                            <tr>
                                <td data-i18n="dice-pool">Dice Pool</td>
                                <td><input type="text" name="attr_horror_dice_pool_1" /></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td data-i18n="duration">Duration</td>
                                <td><input type="text" name="attr_horror_use_duration_1" /></td>
                                <td data-i18n="action">Action</td>
                                <td><input type="text" name="attr_horror_use_action_1" /></td>
                            </tr>
                        </table>
                        <br>
                        <table class="devotions" style="width:100%">
                            <tr class="horror_use_desc">
                                <td data-i18n="horror">Horror</td>
                                <td><input type="text" name="attr_horror_name_2" /></td>
                                <td data-i18n="cost">Cost</td>
                                <td><input type="text" name="attr_horror_cost_2" /><br></td>
                            </tr>
                            <tr>
                                <td colspan="4"><textarea name="attr_horror_use_text_2" rows="3" wrap="soft"
                                        style="width:97%" placeholder="Description"></textarea></td>
                            </tr>
                            <tr>
                                <td data-i18n="dice-pool">Dice Pool</td>
                                <td><input type="text" name="attr_horror_dice_pool_2" /></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td data-i18n="duration">Duration</td>
                                <td><input type="text" name="attr_horror_use_duration_2" /></td>
                                <td data-i18n="action">Action</td>
                                <td><input type="text" name="attr_horror_use_action_2" /></td>
                            </tr>
                        </table>
                        <br>
                        <table class="devotions" style="width:100%">
                            <tr class="horror_use_desc">
                                <td data-i18n="horror">Horror</td>
                                <td><input type="text" name="attr_horror_name_3" /></td>
                                <td data-i18n="cost">Cost</td>
                                <td><input type="text" name="attr_horror_cost_3" /><br></td>
                            </tr>
                            <tr>
                                <td colspan="4"><textarea name="attr_horror_use_text_3" rows="3" wrap="soft"
                                        style="width:97%" placeholder="Description"></textarea></td>
                            </tr>
                            <tr>
                                <td data-i18n="dice-pool">Dice Pool</td>
                                <td><input type="text" name="attr_horror_dice_pool_3" /></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td data-i18n="duration">Duration</td>
                                <td><input type="text" name="attr_horror_use_duration_3" /></td>
                                <td data-i18n="action">Action</td>
                                <td><input type="text" name="attr_horror_use_action_3" /></td>
                            </tr>
                        </table>
                    </div>
                    <div class="sheet-col">
                        <table class="devotions" style="width:100%">
                            <tr class="horror_use_desc">
                                <td data-i18n="horror">Horror</td>
                                <td><input type="text" name="attr_horror_name_4" /></td>
                                <td data-i18n="cost">Cost</td>
                                <td><input type="text" name="attr_horror_cost_4" /></td>
                            </tr>
                            <tr>
                                <td colspan="4"><textarea name="attr_horror_use_text_4" rows="3" wrap="soft"
                                        style="width:97%" placeholder="Description"></textarea></td>
                            </tr>
                            <tr>
                                <td data-i18n="dice-pool">Dice Pool</td>
                                <td><input type="text" name="attr_horror_dice_pool_4" /></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td data-i18n="duration">Duration</td>
                                <td><input type="text" name="attr_horror_use_duration_4" /></td>
                                <td data-i18n="action">Action</td>
                                <td><input type="text" name="attr_horror_use_action_4" /></td>
                            </tr>
                        </table>
                        <br>
                        <table class="devotions" style="width:100%">
                            <tr class="horror_use_desc">
                                <td data-i18n="horror">Horror</td>
                                <td><input type="text" name="attr_horror_name_5" /></td>
                                <td data-i18n="cost">Cost</td>
                                <td><input type="text" name="attr_horror_cost_5" /><br></td>
                            </tr>
                            <tr>
                                <td colspan="4"><textarea name="attr_horror_use_text_5" rows="3" wrap="soft"
                                        style="width:97%" placeholder="Description"></textarea></td>
                            </tr>
                            <tr>
                                <td data-i18n="dice-pool">Dice Pool</td>
                                <td><input type="text" name="attr_horror_dice_pool_5" /></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td data-i18n="duration">Duration</td>
                                <td><input type="text" name="attr_horror_use_duration_5" /></td>
                                <td data-i18n="action">Action</td>
                                <td><input type="text" name="attr_horror_use_action_5" /></td>
                            </tr>
                        </table>
                        <br>
                        <table class="devotions" style="width:100%">
                            <tr class="horror_use_desc">
                                <td data-i18n="horror">Horror</td>
                                <td><input type="text" name="attr_horror_name_6" /></td>
                                <td data-i18n="cost">Cost</td>
                                <td><input type="text" name="attr_horror_cost_6" /><br></td>
                            </tr>
                            <tr>
                                <td colspan="4"><textarea name="attr_horror_use_text_6" rows="3" wrap="soft"
                                        style="width:97%" placeholder="Description"></textarea></td>
                            </tr>
                            <tr>
                                <td data-i18n="dice-pool">Dice Pool</td>
                                <td><input type="text" name="attr_horror_dice_pool_6" /></td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td data-i18n="duration">Duration</td>
                                <td><input type="text" name="attr_horror_use_duration_6" /></td>
                                <td data-i18n="action">Action</td>
                                <td><input type="text" name="attr_horror_use_action_6" /></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="section-header">
                <h2><span data-i18n="artifacts">Artifacts</span></h2>
            </div>
            <div class="columns">
                <div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_1_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_1" value="0">
                            <button type="action" class="dot zero" name="act_artifact_1-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_1-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_1-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_1-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_1-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_1-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_2_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_2" value="0">
                            <button type="action" class="dot zero" name="act_artifact_2-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_2-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_2-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_2-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_2-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_2-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_3_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_3" value="0">
                            <button type="action" class="dot zero" name="act_artifact_3-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_3-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_3-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_3-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_3-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_3-5"></button>
                        </div>
                    </div>
                </div>
                <div class="horizontal-spacer"></div>
                <div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_4_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_4" value="0">
                            <button type="action" class="dot zero" name="act_artifact_4-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_4-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_4-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_4-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_4-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_4-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_5_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_5" value="0">
                            <button type="action" class="dot zero" name="act_artifact_5-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_5-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_5-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_5-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_5-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_5-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_6_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_6" value="0">
                            <button type="action" class="dot zero" name="act_artifact_6-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_6-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_6-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_6-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_6-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_6-5"></button>
                        </div>
                    </div>
                </div>
                <div class="horizontal-spacer"></div>
                <div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_7_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_7" value="0">
                            <button type="action" class="dot zero" name="act_artifact_7-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_7-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_7-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_7-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_7-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_7-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_8_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_8" value="0">
                            <button type="action" class="dot zero" name="act_artifact_8-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_8-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_8-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_8-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_8-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_8-5"></button>
                        </div>
                    </div>
                    <div class="sheet-input-group">
                        <input type="text" name="attr_artifact_9_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_9" value="0">
                            <button type="action" class="dot zero" name="act_artifact_9-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_9-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_9-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_9-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_9-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_9-5"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-content tab3">
        <div class="tabbed-panel">
            <div class="row-panel">
                <div class="center">
                    <h2><span data-i18n="expanded-merits">Expanded Merits</span></h2>
                </div>
                <div class="sheet-2colrow">
                    <div class="sheet-col">
                        <div class="center">
                            <h3 data-i18n="allies">Allies</h3>
                        </div>
                        <textarea name="attr_allies_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_allies_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_allies_3" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="contacts">Contacts</h3>
                        </div>
                        <textarea name="attr_contacts_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_contacts_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_contacts_3" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="mystery-cult">Mystery Cult</h3>
                        </div>
                        <textarea name="attr_cult_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_cult_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_cult_3" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="mentor">Mentor</h3>
                        </div>
                        <textarea name="attr_mentor_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_mentor_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_mentor_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    </div>
                    <div class="sheet-col">
                        <div class="center">
                            <h3 data-i18n="resources">Resources</h3>
                        </div>
                        <textarea name="attr_resources_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_resources_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_resources_3" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="retainer">Retainer</h3>
                        </div>
                        <textarea name="attr_retainer_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_retainer_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_retainer_3" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="status">Status</h3>
                        </div>
                        <textarea name="attr_status_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_status_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_status_3" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center"><input type="text" name="attr_expanded_other_merit" placeholder="Other" />
                        </div>
                        <textarea name="attr_expanded_other_merit_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_expanded_other_merit_2" rows="3" wrap="soft" style="width:100%"></textarea>
                        <textarea name="attr_expanded_other_merit_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    </div>
                </div>
                <div class="center">
                    <h2><span data-i18n="possessions">Possessions</span></h2>
                </div>
                <div class="sheet-2colrow">
                    <div class="sheet-col">
                        <div class="center">
                            <h3 data-i18n="gear-carried">Gear (carried)</h3>
                        </div>
                        <textarea name="attr_gear_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="vehicles">Vehicles</h3>
                        </div>
                        <textarea name="attr_vehicles_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    </div>
                    <div class="sheet-col">
                        <div class="center">
                            <h3 data-i18n="equipment-owned">Equipment (owned)</h3>
                        </div>
                        <textarea name="attr_equipment_1" rows="3" wrap="soft" style="width:100%"></textarea>
                        <div class="center">
                            <h3 data-i18n="misc">Misc</h3>
                        </div>
                        <textarea name="attr_misc_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    </div>
                </div>
                <div class="center">
                    <h2><span data-i18n="sanctuary">Sanctuary</span></h2>
                </div>
                <table style="width:70%">
                    <tr>
                        <th class="center" data-i18n="location">Location</th>
                        <th colspan="4" class="left" data-i18n="description">Description</th>
                    </tr>
                    <tr>
                        <td><input type="text" name="attr_location_1" /></td>
                        <td colspan="4"><input type="text" name="attr_description_1" style="width:100%" /></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="attr_location_2" /></td>
                        <td colspan="4"><input type="text" name="attr_description_2" style="width:100%" /></td>
                    </tr>
                    <tr>
                        <td><input type="text" name="attr_location_3" /></td>
                        <td colspan="4"><input type="text" name="attr_description_3" style="width:100%" /></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="tab-content tab4">
        <div class="tabbed-panel">
            <div class="row-panel">
                <div class="center">
                    <h2><span data-i18n="history">History</span></h2>
                </div>
                <textarea name="attr_history" rows="3" wrap="soft" style="width:99%"></textarea>
                <br>
                <div class="center">
                    <h2><span data-i18n="description">Description</span></h2>
                </div>
                <textarea name="attr_description" rows="3" wrap="soft" style="width:99%"></textarea>
                <br>
                <table class="grid">
                    <tr>
                        <th class="right" data-i18n="age">Age</th>
                        <td><input type="text" name="attr_age" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="apparent-age">Apparent Age</th>
                        <td><input type="text" name="attr_apparent-age" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="date-of-birth">Date of Birth</th>
                        <td><input type="text" name="attr_date_of_birth" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="rip">R.I.P.</th>
                        <td><input type="text" name="attr_rip" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="hair">Hair</th>
                        <td><input type="text" name="attr_hair" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="eyes">Eyes</th>
                        <td><input type="text" name="attr_eyes" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="race">Race</th>
                        <td><input type="text" name="attr_race" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="nationality">Nationality</th>
                        <td><input type="text" name="attr_nationality" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="height">Height</th>
                        <td><input type="text" name="attr_height" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="weight">Weight</th>
                        <td><input type="text" name="attr_weight" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="gender">Gender</th>
                        <td><input type="text" name="attr_gender" /></td>
                    </tr>
                    <tr>
                        <th class="right" data-i18n="sexual-orientation">Sexual Orientation</th>
                        <td><input type="text" name="attr_sexual_orientation" /></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="tab-content tab5">
        <div class="tabbed-panel">
            <div class="row-panel">
                <div class="center">
                    <h2><span data-i18n="settings">Settings</span></h2>
                </div>
                <div>
                    <h3 data-i18n="defense-settings">Defense Settings</h3>
                    <span data-i18n="defense-trait">Defense Trait</span>: <select name="attr_defense_attr">
                        <option value="lowest" selected data-i18n="lowest">Lowest</option>
                        <option value="highest" data-i18n="highest">Highest</option>
                        <option value="wits" data-i18n="wits">Wits</option>
                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                    </select>
                    <select name="attr_defense_skill">
                        <option value="nothing"></option>
                        <option value="athletics" selected data-i18n="athletics">+ Athletics</option>
                        <option value="brawl" data-i18n="brawl">+ Brawl</option>
                        <option value="weaponry" data-i18n="weaponry">+ Weaponry</option>
                    </select>
                    <span data-i18n="defense-bonus">Defense Bonus</span>: <input type="number" name="attr_defense_bonus"
                        value="0" />
                    <div>
                        <h3 data-i18n="health-settings">Health Settings</h3>
                        <span data-i18n="base-size">Base Size</span>: <input type="number" name="attr_base_size"
                            value="5" />
                        <span class="checkbox">
                            <input type="hidden" class="flag" name="attr_giant" value="0">
                            <button type="action" name="act_giant"></button>
                            <button type="action" class="toggle" name="act_giant" data-i18n="giant">Giant</button>
                        </span>
                        <span class="checkbox">
                            <input type="hidden" class="flag" name="attr_small_framed" value="0">
                            <button type="action" name="act_small_framed"></button>
                            <button type="action" class="toggle" name="act_small_framed" data-i18n="small-framed">Small
                                Framed</button>
                        </span>
                        <br>
                        <span data-i18n="iron-stamina">Iron Stamina</span>: <input type="number"
                            name="attr_iron_stamina" value="0" />
                    </div>
                    <div>
                        <h3 data-i18n="speed-settings">Speed Settings</h3>
                        <span data-i18n="species-factor">Species Factor</span>:<input type="number"
                            name="attr_species_factor" value="5" />
                        <span data-i18n="fleet-of-foot">Fleet of Foot</span>: <input type="number"
                            name="attr_fleet_of_foot" style="width: 55px;" value="0" />
                    </div>
                    <div>
                        <h3 data-i18n="initiative-settings">Initiative Settings</h3>
                        <span data-i18n="fast-reflexes">Fast Reflexes</span>: <input type="number"
                            name="attr_fast_reflexes" value="0" />
                        <span class="checkbox">
                            <input type="hidden" class="flag" name="attr_shoot_first" value="0">
                            <button type="action" name="act_shoot_first"></button>
                            <button type="action" class="toggle" name="act_shoot_first" data-i18n="shoot-first">Shoot
                                First</button>
                        </span>
                        <span data-i18n="initiative-bonus">Initiative Bonus</span>: <input type="number"
                            name="attr_initiative_bonus" value="0" />
                    </div>
                    <div>
                        <h3 data-i18n="vitality-settings">Vitality Settings</h3>
                        <span data-i18n="vitality-rating">Vitality Rating</span>: <input type="number"
                            name="attr_vitality" value="6" />
                        <span data-i18n="luminous">Luminous</span>: <input type="number" name="attr_luminous"
                            value="0" />
                        <span class="checkbox">
                            <input type="hidden" class="flag" name="attr_shared_vitality" value="0">
                            <button type="action" name="act_shared_vitality"></button>
                            <button type="action" class="toggle" name="act_shared_vitality" data-i18n="shared-vitality">Shared Vitality</button>
                        </span>
                    </div>
                    <div>
                        <h3 data-i18n="sheet-settings">Sheet Settings</h3>
                        <span class="checkbox">
                            <input type="hidden" class="flag" name="attr_enable_profession" value="0">
                            <button type="action" name="act_enable_profession"></button>
                            <button type="action" class="toggle" name="act_enable_profession"
                                data-i18n="enable-checkbox-for-rote-msg">Enable
                                checkboxes next to skills (Normally used for professions, rote skills, etc)</button>
                        </span>
                        <span class="checkbox">
                            <input type="hidden" class="flag" name="attr_enable_specialties" value="0">
                            <button type="action" name="act_enable_specialties"></button>
                            <button type="action" class="toggle" name="act_enable_specialties"
                                data-i18n="enable-specialty-edit-msg">Display
                                specialty input field next to
                                skills</button>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- HIDDEN FIELDS AND FORMULAS -->
<input type="hidden" name="attr_version" value="0" />
<input type="hidden" name="attr_health" value="0" />
<input type="hidden" name="attr_speed_base" value="0" />
<input type="hidden" name="attr_speed_penalty" value="0" />
<input type="hidden" name="attr_defense_base" value="0" />
<input type="hidden" name="attr_defense_penalty" value="0" />
<input type="hidden" name="attr_initiative_penalty" value="0" />
<input type="hidden" name="attr_initiative_base" value="0" />
<input type="hidden" name="attr_shoot_first_bonus" value="0" />
<input type="hidden" name="attr_initiative_bonus" value="0" />
<input type="hidden" name="attr_balistic_armor"
    value="((@{armor_ballistic0}+0)*@{armor_flag0})+((@{armor_ballistic1}+0)*@{armor_flag1})+((@{armor_ballistic2}+0)*@{armor_flag2})+((@{armor_ballistic3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_general_armor"
    value="((@{armor_general0}+0)*@{armor_flag0})+((@{armor_general1}+0)*@{armor_flag1})+((@{armor_general2}+0)*@{armor_flag2})+((@{armor_general3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_defense_penalty"
    value="((@{armor_defense0}+0)*@{armor_flag0})+((@{armor_defense1}+0)*@{armor_flag1})+((@{armor_defense2}+0)*@{armor_flag2})+((@{armor_defense3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_speed_penalty"
    value="((@{armor_speed0}+0)*@{armor_flag0})+((@{armor_speed1}+0)*@{armor_flag1})+((@{armor_speed2}+0)*@{armor_flag2})+((@{armor_speed3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_weapon_penalty" value="0" />
<input type="hidden" name="attr_armor_penalty" value="0" />
<input type="hidden" name="attr_wound_penalty" value="0" />
<input type="hidden" name="attr_attack_name" value="" />
<input type="hidden" name="attr_dice_pool_attributes" value="" />
<input type="hidden" name="attr_dice_pool_html" value="" />
<input type="hidden" name="attr_dice_pool" value="0" />
<input type="hidden" name="attr_rolltype" value=")d10!cs>10}>8]]}}" />
<input type="hidden" name="attr_incorporeal" value="0" />
<!-- Roll Templates -->
<div class="rolltemplates">
    <rolltemplate class="sheet-rolltemplate-wod">
        <table>
            <tr>
                <th class="sheet-always-light">{{name}}
                    {{#reason}}
                    <span data-i18n="tries-to">tries to </span>{{reason}}
                    {{/reason}}
                </th>
            </tr>
            <tr>
                <td>
                    {{dicePoolHtml}}
                </td>
            </tr>
            <tr>
                <td class="sheet-result"><span>{{computed::successType}} </span><span>[{{result}}]</span></td>
            </tr>
            <tr>
                <td class="sheet-specialrollflag">
                    {{#9again}}
                    <span>9A</span>
                    {{/9again}}
                    {{#8again}}
                    <span>8A</span>
                    {{/8again}}
                    {{#isRote}}
                    <span data-i18n="rote">Rote</span>
                    {{/isRote}}
                    {{#chance}}
                    <span>0C</span>
                    {{/chance}}
                </td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-wod-simple">
        <table>
            <tr>
                <th class="sheet-always-light">{{name}}
                    {{#reason}}
                    <span data-i18n="tries-to">tries to </span>{{reason}}
                    {{/reason}}
                </th>
            </tr>
            <tr>
                <td>
                    <span class="sheet-result">{{dicePool}}</span> <span data-i18n="dice-for">Dice</span><br>
                </td>
            </tr>
            <tr>
                <td class="sheet-result"><span>{{result}}</span> <span data-i18n="successes">Successes</span></td>
            </tr>
            <tr>
                <td class="sheet-specialrollflag">
                    {{#9again}}
                    <span>9A</span>
                    {{/9again}}
                    {{#8again}}
                    <span>8A</span>
                    {{/8again}}
                    {{#isRote}}
                    <span data-i18n="rote">Rote</span>
                    {{/isRote}}
                    {{#chance}}
                    <span>0C</span>
                    {{/chance}}
                </td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-wod-initiative">
        <table>
            <tr>
                <th class="sheet-always-light">{{name}} <span data-i18n="rolls">rolls</span> <span
                        data-i18n="initiative">Initiative</span></th>
            </tr>
            <tr>
                <td class="sheet-always-light">
                    <span data-i18n="dexterity">Dexterity</span><span>({{dexterity}})</span>,
                    <span data-i18n="composure">Composure</span><span>({{composure}})</span>
                    {{#rollGreater() fastReflexes 0}}
                    <span data-i18n="fast-reflexes">Fast Reflexes Bonus</span> <span>({{fastReflexesVal}}</span>)<br>
                    {{/rollGreater() fastReflexes 0}}
                    {{#rollGreater() shootFirst 0}}
                    <span data-i18n="shoot-first">Shoot First Bonus</span> <span>({{firearms}})</span><br>
                    {{/rollGreater() shootFirst 0}}
                    {{#^rollTotal() initiativeBonus 0}}
                    <span data-i18n="initiative-bonus">Initiative Bonus</span> <span>({{initiativeBonusVal}})</span><br>
                    {{/^rollTotal() initiativeBonus 0}}
                    {{#rollLess() initiativePenalty 0}}
                    <span data-i18n="initiative-penalty">Initiative Penalty</span>
                    <span>({{initiativePenaltyVal}})</span><br>
                    {{/rollLess() initiativePenalty 0}}
                </td>
            </tr>
            <tr>
                <td class="sheet-result"><span data-i18n="initiative">Initiative</span> {{result}}</td>
            </tr>
            <tr>
                <td class="sheet-specialrollflag"></td>
            </tr>
        </table>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-wod-attack">
        <table>
            <tr>
                <th class="sheet-always-light">{{name}} <span data-i18n="makes-a">makes a</span> {{attack_name}} <span
                        data-i18n="attack">attack</span>
                        {{#reason}}
                        {{reason}}
                        {{/reason}}
                    </th>
            </tr>
            <tr>
                <td>
                    {{dicePoolHtml}}
                </td>
            </tr>
            {{#rollTotal() result 0}}
            <tr>
                <td class="sheet-result sheet-miss"><span data-i18n="and-misses-with">and misses with</span> <span>{{result}}</span></td>
            </tr>
            {{/rollTotal() result 0}}
            {{#rollGreater() result 0}}
            <tr>
                <td class="sheet-result sheet-miss"><span data-i18n="and-hits-for">and hits for</span> <span>{{result}} + {{attack_damage}} = {{computed::totalDamage}} {{attack_damage_type}}</span> <span
                        data-i18n="damage">Damage</span></td>
            </tr>
            {{/rollGreater() result 0}}
            <tr>
                <td class="sheet-specialrollflag">
                    {{#9again}}
                    <span>9A</span>
                    {{/9again}}
                    {{#8again}}
                    <span>8A</span>
                    {{/8again}}
                    {{#isRote}}
                    <span data-i18n="rote">Rote</span>
                    {{/isRote}}
                    {{#chance}}
                    <span>0C</span>
                    {{/chance}}
                </td>
            </tr>
        </table>
    </rolltemplate>
</div>

<script type="text/worker">
    const attributes = [
    'intelligence',
    'wits',
    'resolve',
    'strength',
    'dexterity',
    'stamina',
    'presence',
    'manipulation',
    'composure',
  ]
  const mentalSkills = [
    'academics',
    'computer',
    'crafts',
    'investigation',
    'medicine',
    'occult',
    'politics',
    'science',
  ]
  const physicalSkills = [
    'athletics',
    'brawl',
    'drive',
    'firearms',
    'larceny',
    'stealth',
    'survival',
    'weaponry',
  ]
  const socialSkills = [
    'animalken',
    'empathy',
    'expression',
    'intimidation',
    'persuasion',
    'socialize',
    'streetwise',
    'subterfuge',
  ]
  const skills = [...mentalSkills, ...physicalSkills, ...socialSkills]
  const skillSpecializations = skills.map((skill) => `specialization_${skill}`)
  const normalStats = [...attributes, ...skills]
  const sizeStats = ['base_size', 'giant', 'small_framed']
  const woundPenaltyStats = ['iron_stamina', 'incorporeal']
  const speedStats = ['species_factor', 'fleet_of_foot']
  const defenseStats = ['defense_attr', 'defense_skill', 'defense_bonus']
  const initiativeStats = ['shoot_first']
  const allStats = [
    ...normalStats,
    ...skillSpecializations,
    ...sizeStats,
    ...speedStats,
    ...defenseStats,
    ...initiativeStats,
    ...woundPenaltyStats,
  ]

  const derivedHealthStats = [...sizeStats, 'stamina']
  const derivedSpeedStats = ['dexterity', 'strength', ...speedStats]
  const derivedDefenseStats = [
    'wits',
    'dexterity',
    'athletics',
    'brawl',
    'weaponry',
    ...defenseStats,
  ]
  const derivedInitiativeStats = [
    'dexterity',
    'composure',
    'firearms',
    'shoot_first',
  ]
  const derivedWillpowerStats = ['resolve', 'composure']
  const derivedWoundPenaltyStats = ['iron_stamina']

  const maxValues = {
    fleet_of_foot: 3,
    iron_stamina: 3,
    vitality: 10,
    spite: 10,
  }

  allStats.forEach((attr) => {
    on(`change:${attr}`, (eventInfo) => {
      const statUpdaters = [
        [derivedHealthStats, updateHealth],
        [derivedSpeedStats, updateSpeed],
        [derivedDefenseStats, updateDefense],
        [derivedInitiativeStats, updateInitiative],
        [derivedWillpowerStats, updateWillpower],
        [derivedWoundPenaltyStats, updateWoundPenalties],
        [skillSpecializations, updateSpecializationVisible],
      ]
      const source = eventInfo.sourceAttribute
      fixMaxOverflow(eventInfo)
      updateDicePool()
      updateStats(statUpdaters, source)
    })

    on(`clicked:${attr}`, () => {
      updateDicePoolAttributes(attr)
    })
  })

  const fixMaxOverflow = (eventInfo) => {
    const source = eventInfo.sourceAttribute
    const maxValue = maxValues[source]
    if (maxValue) {
      getAttrs([source], (v) => {
        const value = parseInt(v[source])
        if (value > maxValue) {
          setAttrs({
            [source]: eventInfo.previousValue,
          })
        }
      })
    }
  }

  const updateStats = (statUpdaters, source) => {
    statUpdaters.forEach(([stats, updater]) => {
      if (stats.includes(source)) {
        updater()
      }
    })
  }

  const multidotTraits = ['extra_trait', 'artifact']

  const dotAttrs = [
    ...attributes,
    ...skills,
    'repeating_merit:merit',
    'spite',
    ...[...Array(8).keys()].flatMap((i) =>
      multidotTraits.map((t) => `${t}_${i}`),
    ),
  ]

  const dotButtonCount = 16
  // Set hidden attr on dot button click
  dotAttrs.forEach((attr) => {
    new Array(dotButtonCount).fill(1).forEach((_, dot) => {
      on(`clicked:${attr}-${dot}`, () => {
        setAttrs({
          [attr.replace(':', '_')]: dot,
        })
      })
    })
  })

  const checkboxAttributes = [
    'small_framed',
    'giant',
    'shoot_first',
    'shared_vitality',
    'enable_profession',
    'enable_specialties',
    'armor_flag0',
    'armor_flag1',
    'armor_flag2',
    'armor_flag3',
    'projected',
    'academics_box',
    'computer_box',
    'crafts_box',
    'investigation_box',
    'medicine_box',
    'occult_box',
    'politics_box',
    'science_box',
    'athletics_box',
    'brawl_box',
    'drive_box',
    'firearms_box',
    'larceny_box',
    'stealth_box',
    'survival_box',
    'weaponry_box',
    'animalken_box',
    'empathy_box',
    'expression_box',
    'intimidation_box',
    'persuasion_box',
    'socialize_box',
    'streetwise_box',
    'subterfuge_box',
  ]
  checkboxAttributes.forEach((checkboxAttribute) => {
    on(`clicked:${checkboxAttribute}`, () => {
      const attr = checkboxAttribute.replace(':', '_')
      getAttrs([attr], (values) => {
        const checkboxValue = ['1', 'on'].includes(values[attr])
        setAttrs({
          [attr]: checkboxValue ? '0' : '1',
        })
      })
    })
  })

  const attackSelectCount = 6
  const attackRadioAttributes = new Array(attackSelectCount)
    .fill(1)
    .map((_, index) => `attack_${index}`)

  attackRadioAttributes.forEach((radioAttribute, index) => {
    on(`clicked:${radioAttribute}`, () => {
      getAttrs(attackRadioAttributes, (values) => {
        const clearFlags = attackRadioAttributes
          .map((clearRadioAttribute) => `${clearRadioAttribute}_flag`)
          .reduce((acc, flag) => ({ ...acc, [flag]: '0' }), {})
        setAttrs({
          ...clearFlags,
          selected_attack: index,
          [`${radioAttribute}_flag`]: '1',
        })
      })
    })
  })

  const currentValueSeriesAttributes = ['willpower', 'vitality', 'spite']
  const currentValueAttributes = [
    ...currentValueSeriesAttributes.flatMap((currentValueSeriesAttribute) =>
      new Array(30)
        .fill(1)
        .map((_, i) => `${currentValueSeriesAttribute}_box${i + 1}`),
    ),
  ]

  currentValueAttributes.forEach((currentValueAttribute) => {
    on(`clicked:${currentValueAttribute}`, () => {
      const [attribute, value] = currentValueAttribute.split('_box')
      const attr = `current_${attribute}`
      const clickedValue = parseInt(value)
      getAttrs([attr], (v) => {
        const currentValue = parseInt(v[attr])
        const newValue =
          currentValue === clickedValue ? currentValue - 1 : clickedValue
        setAttrs({
          [`current_${attribute}`]: newValue,
        })
      })
    })
  })

  const updateHealth = () => {
    getAttrs(
      ['stamina', 'resolve', 'base_size', 'giant', 'small_framed'],
      (v) => {
        const health =
          Number(v.stamina) +
          Number(v.base_size) +
          Number(v.giant) -
          Number(v.small_framed)
        setAttrs({
          health,
        })
      },
    )
  }

  const updateSpeed = () => {
    getAttrs(['dexterity', 'strength'], (v) => {
      speed = (parseInt(v.strength) || 0) + (parseInt(v.dexterity) || 0)
      setAttrs({
        speed_base: speed,
      })
    })
  }

  const updateDefense = () => {
    getAttrs(
      [
        'defense_attr',
        'defense_skill',
        'entity',
        'athletics',
        'brawl',
        'dexterity',
        'weaponry',
        'wits',
      ],
      (v) => {
        setAttrs({
          defense_base: getDefenseAttr(v) + getDefenseSkill(v),
        })
      },
    )
  }

  const getDefenseAttr = (v) => {
    const dexterity = parseInt(v.dexterity, 10) || 0
    const wits = parseInt(v.wits, 10) || 10
    switch (v.defense_attr) {
      case 'lowest':
        return Math.min(dexterity, wits)
      case 'highest':
        return Math.max(dexterity, wits)
      case 'wits':
        return wits
      case 'dexterity':
        return dexterity
    }
  }

  const getDefenseSkill = (v) => {
    const skill = v.defense_skill
    if (skill === 'nothing') {
      return 0
    }
    return parseInt(v[skill], 10) || 0
  }

  const updateInitiative = () => {
    getAttrs(['dexterity', 'composure', 'shoot_first', 'firearms'], (v) => {
      const initiativeBase =
        (parseInt(v.dexterity) || 0) + (parseInt(v.composure) || 0)
      const shootFirstBonus =
        v.shoot_first === '1' ? parseInt(v.firearms) || 0 : 0
      setAttrs({
        initiative_base: initiativeBase,
        shoot_first_bonus: shootFirstBonus,
      })
    })
  }

  const updateWillpower = () => {
    getAttrs(['resolve', 'composure', 'current_willpower'], (v) => {
      const resolve = parseInt(v.resolve) || 0
      const composure = parseInt(v.composure) || 0
      const currentWillpower = parseInt(v.current_willpower) || 0
      const willpower = resolve + composure
      const newCurrentWp =
        currentWillpower > willpower ? willpower : currentWillpower
      setAttrs({
        willpower,
        current_willpower: newCurrentWp,
      })
    })
  }

  on('change:current_willpower', () => {
    getAttrs(['current_willpower', 'rollmodify_willpower'], (v) => {
      const currentWillpower = parseInt(v.current_willpower) || 0
      const rollmodifyWillpower = parseInt(v.rollmodify_willpower) || 0
      if (currentWillpower <= 0 && rollmodifyWillpower > 0) {
        setAttrs({
          rollmodify_willpower: 0,
        })
      }
    })
  })

  const updateSpecializationVisible = () => {
    getAttrs(skillSpecializations, (v) => {
      const specializationVisibility = skillSpecializations.reduce(
        (acc, skill) => ({
          ...acc,
          [`has_${skill}`]: v[skill] ? '1' : '0',
        }),
        {},
      )
      setAttrs(specializationVisibility)
    })
  }

  //Health boxes
  // trait name and depth (number of distinct healthbox states)
  const healthTraits = { healthbox: 4 }
  // Create array of all health attribute names, with values 1 through 24 for each health trait.
  const healthAttrs = Object.keys(healthTraits).reduce(
    (attrs, trait) => ({
      ...attrs,
      ...new Array(24)
        .fill(1)
        .map((_, index) => `${trait}_${index + 1}`)
        .reduce(
          (traitAttrs, traitAttr) => ({
            ...traitAttrs,
            [traitAttr]: healthTraits[trait],
          }),
          {},
        ),
    }),
    {},
  )

  // Register button click event for each health attribute
  Object.entries(healthAttrs).forEach(([attr, depth]) => {
    on(`clicked:${attr}`, () => {
      // Increment / cycle corresponding attribute value
      getAttrs([attr], (v) => {
        const healthValue = parseInt(v[attr]) || 0
        setAttrs({
          [attr]: (healthValue + 1) % depth,
        })
      })
    })
  })

  const updateWoundPenalties = () => {
    getAttrs(['iron_stamina'], (v) => {
      const ironStamina = parseInt(v.iron_stamina, 10) || 0
      const woundPenalties = getWoundPenalties(ironStamina)

      setAttrs(woundPenalties)
    })
  }

  const getWoundPenalties = (ironStamina) => {
    const maxPenalty = Math.min(ironStamina, 3) - 3
    // Whitespace instead of empty string to avoid displaying default value
    return {
      wound_penalty_1: Math.min(maxPenalty + 2, 0) || ' ',
      wound_penalty_2: Math.min(maxPenalty + 1, 0) || ' ',
      wound_penalty_3: Math.min(maxPenalty, 0) || ' ',
    }
  }

  const incorporealAttr = ['lament', 'projected']
    .map((attr) => `change:${attr}`)
    .join(' ')
  on(incorporealAttr, () => {
    updateIncorporeal()
  })

  const updateIncorporeal = () => {
    getAttrs(['lament', 'projected'], (v) => {
      const lament = v.lament || ''
      const projected = v.projected || ''
      const incorporeal = lament === 'spirit' || lament === 'hue' || projected
      setAttrs({
        incorporeal,
      })
    })
  }

  const armorSelectCount = 4
  const updateAttackAttrs = [
    'strength',
    'iron_stamina',
    'incorporeal',
    'health',
    'selected_attack',
    'rollstyle',
    ...[
      '_initiative',
      '_strength',
      '_name',
      '_type',
      '_damage_type',
      '_damage',
    ].flatMap((attr) =>
      [...new Array(attackSelectCount).keys()].map((i) => `attack${attr}${i}`),
    ),
    ...[...Array(dotButtonCount).keys()].map((i) => `healthbox_${i + 1}`),
  ]

  const updateAttackTriggers = updateAttackAttrs
    .map((attr) => `change:${attr}`)
    .join(' ')

  on(updateAttackTriggers, () => {
    updateAttacks()
  })

  const updateAttacks = () => {
    getAttrs(updateAttackAttrs, (v) => {
      const atknum = parseInt(v.selected_attack, 10) || 0
      const str = parseInt(v.strength, 10) || 0
      const isCorporeal = (parseInt(v.incorporeal) || 0) === 0 ? true : false
      const rollStyle = v.rollstyle || 'sheet'

      const initiativePenalty = parseInt(v[`attack_initiative${atknum}`]) || 0
      const attackStrength = parseInt(v[`attack_strength${atknum}`]) || 0
      const weaponStrPenalty = Math.min(str - attackStrength, 0)
      const attackName = v[`attack_name${atknum}`] || ''
      const attackType = v[`attack_type${atknum}`] || ''
      const attackDamage = v[`attack_damage${atknum}`] || 0
      const attackDmgType = v[`attack_damage_type${atknum}`] || ''
      const armorPenaltyApplies =
        attackType.includes('brawl') || attackType.includes('melee')
      const armorStrPenalty = armorPenaltyApplies
        ? [...new Array(3).keys()].reduce((penalty, index) => {
            const armorFlag = parseInt(v[`armor_flag${index}`]) || 0
            const armorStrength = parseInt(v[`armor_strength${index}`]) || 0
            const armorStrengthPenalty =
              str < armorStrength ? str - armorStrength : 0
            return penalty + (armorFlag === '1' ? armorStrengthPenalty : 0)
          }, 0)
        : 0

      const ironStamina = parseInt(v.iron_stamina, 10)

      const woundPenalty = [...new Array(3).keys()]
        .map((i) => v[`healthbox_${v.health - i}`])
        .reduce((penalty, healthAttr) => {
          const woundPenalty = isCorporeal && healthAttr !== 0 ? -1 : 0
          return Math.min(ironStamina, penalty + woundPenalty)
        }, 0)

      setAttrs({
        weapon_penalty: weaponStrPenalty,
        armor_penalty: armorStrPenalty,
        initiative_penalty: initiativePenalty,
        wound_penalty: woundPenalty,
        attack_name: attackName,
        attack_damage: attackDamage,
        attack_damage_type: attackDmgType,
      })

      if (rollStyle !== 'attack') {
        return
      }

      const [attr1, attr2] = getAttackAttributes(v[`attack_type${atknum}`])

      const attackAttrs = [
        getTranslationByKey(`${attr1}-short`),
        getTranslationByKey(attr2),
      ].join(' + ')
      if (attackAttrs === '' || attackName === '') {
        setAttrs({
          active_attack_name: '',
        })
        return
      }

      if (attackName.includes('@{')) {
        const unresolvedName = attackName.substring(2, attackName.length - 1)
        getAttrs([unresolvedName], (v) => {
          const attackName = v[unresolvedName] || ''
          setAttrs({
            active_attack_name: `${attackName}\n(${attackAttrs})`,
          })
        })
      } else {
        setAttrs({
          active_attack_name: `${attackName}\n(${attackAttrs})`,
        })
      }
      getAttrs([`${attr1}_flag`, `${attr2}_flag`], (v) => {
        const attr1Enabled = parseInt(v[`${attr1}_flag`]) || 0
        const attr2Enabled = parseInt(v[`${attr2}_flag`]) || 0
        const updateAttr2 = () => {
          if (attr2Enabled !== 1) {
            updateDicePoolAttributes(attr2)
          }
        }

        if (attr1Enabled !== 1) {
          setAttrs(
            {
              [`${attr1}_flag`]: 1,
            },
            { silent: true },
            () => {
              updateDicePoolAttributes(attr1, updateAttr2)
            },
          )
        } else {
          updateAttr2()
        }
      })
    })
  }

  const getAttackAttributes = (type) => {
    switch (type) {
      case 'brawl':
        return ['strength', 'brawl']
      case 'melee':
        return ['strength', 'weaponry']
      case 'gun':
        return ['dexterity', 'firearms']
      case 'thrown':
        return ['dexterity', 'athletics']
      case 'brawl-fight-finesse':
        return ['dexterity', 'brawl']
      case 'melee-fight-finesse':
        return ['dexterity', 'weaponry']
      default:
        return []
    }
  }

  const updateDicePoolAttributes = (attribute, postUpdateFn) => {
    attribute = attribute.toLowerCase()
    getAttrs([...normalStats, 'dice_pool_attributes'], (v) => {
      let poolAttributes = v['dice_pool_attributes']
        .split(',')
        .filter((poolAttribute) => poolAttribute)

      if (poolAttributes.includes(attribute)) {
        // Remove attribute from roll
        poolAttributes = poolAttributes.filter(
          (poolAttribute) => poolAttribute !== attribute,
        )
      } else {
        // Add attribute to roll
        poolAttributes = poolAttributes.concat(attribute)

        // Cap stats by type
        const poolAttributeTypes = poolAttributes.map((poolAttribute) => ({
          poolAttribute,
          type: getAttributeType(poolAttribute),
        }))
        poolAttributes = poolAttributeTypes
          .filter((x) => x.type === 'attribute')
          .reverse()
          .slice(0, 2)
          .reverse()
          .concat(
            poolAttributeTypes
              .filter((x) => x.type === 'skill')
              .reverse()
              .slice(0, 1)
              .reverse(),
          )
          .slice(-2)
          .map((x) => x.poolAttribute)
      }
      // Create HTML for roll template
      const dicePoolHtml = getSheetDicePoolHtml(poolAttributes, v)

      // Create dice pool for roll
      const dicePool = getSheetDicePool(poolAttributes, v)

      // Create display for dice roller
      const rollDisplay = poolAttributes
        .map(
          (poolAttribute) =>
            v[`${poolAttribute}_name`] || getTranslationByKey(poolAttribute),
        )
        .join(' +\n')

      // Determine flag values
      const flags = [...normalStats]
        .map((flagAttribute) => ({
          flag: `${flagAttribute}_flag`,
          value: poolAttributes.includes(flagAttribute) ? 1 : 0,
        }))
        .reduce((all, next) => ({ ...all, [next.flag]: next.value }), {})

      setAttrs(
        {
          ['dice_pool_attributes']: poolAttributes.join(','),
          ['dice_pool_html']: dicePoolHtml,
          ['dice_pool']: dicePool,
          ['rolldisplay']: rollDisplay,
          ...flags,
        },
        { silent: true },
        () => {
          typeof postUpdateFn === 'function' && postUpdateFn()
        },
      )
    })
  }

  const rollStyles = ['sheet', 'attack', 'simple']
  rollStyles.forEach((rollStyle) => {
    on(`clicked:rollstyle_${rollStyle}`, (eventInfo) => {
      getAttrs(['rollstyle'], (v) => {
        const currentRollStyle = v['rollstyle'] || ''
        if (currentRollStyle === rollStyle) {
          return
        }
        setAttrs({
          ...resetRollFlags(),
          rollstyle: rollStyle,
        })
      })
    })
  })

  on('change:rollstyle', () => {
    updateDicePool()
  })

  const rolltypes = ['normal', '9-again', '8-again']
  rolltypes.forEach((rolltype) => {
    on(`clicked:rolltype_select_${rolltype}`, () => {
      setAttrs({
        rolltype_select: rolltype,
      })
    })
  })

  const rollmodifiers = ['rote', 'willpower', 'specialty']
  rollmodifiers.forEach((rollmodifier) => {
    on(`clicked:rollmodify_select_${rollmodifier}`, () => {
      getAttrs([`rollmodify_${rollmodifier}`], (v) => {
        setAttrs({
          [`rollmodify_${rollmodifier}`]:
            v[`rollmodify_${rollmodifier}`] === '1' ? '0' : '1',
        })
      })
    })
  })

  const rollmodifierRestrictedValues = {
    willpower: 'current_willpower',
  }
  _.keys(rollmodifierRestrictedValues).forEach((restrictedModifier) => {
    const rollModifier = `rollmodify_${restrictedModifier}`
    on(`change:${rollModifier}`, () => {
      const modifierSource = rollmodifierRestrictedValues[restrictedModifier]
      getAttrs([rollModifier, modifierSource], (v) => {
        const value = parseInt(v[modifierSource]) || 0
        const modifierEnabled = (parseInt(v[rollModifier]) || 0) === '1'
        if (value <= 0) {
          setAttrs({
            [rollModifier]: '0',
          })
        }
      })
    })
  })

  on(`change:rollmodify_specialty`, ({ newValue: specialtyEnabled }) => {
    if (!specialtyEnabled) {
      return
    }
    updateUseSpecialty()
  })

  on(`change:dice_pool_attributes`, () => {
    updateUseSpecialty()
    updateDicePool()
  })

  const updateUseSpecialty = () => {
    getAttrs(['dice_pool_attributes'], (v) => {
      const dicePoolAttributes = v['dice_pool_attributes']
        .split(',')
        .filter((poolAttribute) => poolAttribute)
      const specializations = dicePoolAttributes.map(
        (attr) => `has_specialization_${attr}`,
      )
      getAttrs(specializations, (specializationValues) => {
        const hasSpecialization = _.contains(specializationValues, '1')
        if (!hasSpecialization) {
          setAttrs({
            ['rollmodify_specialty']: '0',
          })
        }
      })
    })
  }

  const updateDicePool = () => {
    getAttrs([...normalStats, 'dice_pool_attributes', 'rollstyle'], (v) => {
      const rollStyle = v['rollstyle'] || ''

      if (rollStyle !== 'sheet') {
        return
      }

      const poolAttributes = v['dice_pool_attributes']
        .split(',')
        .filter((poolAttribute) => poolAttribute)
      const dicePoolHtml = getSheetDicePoolHtml(poolAttributes, v)
      const dicePool = getSheetDicePool(poolAttributes, v)

      setAttrs({
        ['dice_pool_html']: dicePoolHtml,
        ['dice_pool']: dicePool,
      })
    })
  }

  const getSheetDicePoolHtml = (poolAttributes, values) => {
    return poolAttributes
      .map((poolAttribute) => ({
        label:
          values[`${poolAttribute}_name`] || getTranslationByKey(poolAttribute),
        value: getAttributePool(poolAttribute, values),
      }))
      .map((stat) => `<div>${stat.label} (${stat.value})</div>`)
      .join('')
  }

  const getSheetDicePool = (poolAttributes, values) => {
    return poolAttributes
      .map((poolAttribute) => getAttributePool(poolAttribute, values))
      .reduce((sum, value) => sum + value, 0)
  }

  const getExplodingDiceTarget = (rollType, isChanceRoll) => {
    if (isChanceRoll) {
      return 10
    }

    switch (rollType) {
      case '9-again':
        return 9
      case '8-again':
        return 8
      default:
        return 10
    }
  }

  const getTargetDifficulty = (isChanceRoll) => {
    if (isChanceRoll) {
      return 10
    }
    return 8
  }

  const getRerollFailures = (isRote, targetDifficulty) => {
    if (!isRote) {
      return ''
    }

    if (isRote) {
      return `ro<${targetDifficulty - 1}`
    }
  }

  const getCriticalFail = (isChanceRoll) => {
    if (isChanceRoll) {
      return 'cf<1'
    }
    return 'cf<0'
  }

  const getAttributeType = (attribute) => {
    if (attributes.includes(attribute)) {
      return 'attribute'
    }
    if (skills.includes(attribute)) {
      return 'skill'
    }
  }

  const getAttributePool = (attribute, values) => {
    return Number(values[attribute]) || getUnskilledPenalty(attribute)
  }

  const getUnskilledPenalty = (attribute) => {
    if (mentalSkills.includes(attribute)) {
      return -3
    }
    if (physicalSkills.includes(attribute)) {
      return -1
    }
    if (socialSkills.includes(attribute)) {
      return -1
    }
    return 0
  }

  const resetRollFlags = () => {
    const flagValues = normalStats
      .map((attribute) => `${attribute}_flag`)
      .reduce((attrs, flag) => ({ ...attrs, [flag]: '' }), {})

    return {
      dice_pool_attributes: '',
      dice_pool_html: '',
      dice_pool: 0,
      rolldisplay: '',
      rollstyle: 'sheet',
      rolltype_select: 'normal',
      rollmodify_rote: '0',
      rollmodify_willpower: '0',
      rollmodify_modifier: '0',
      rollmodify_specialty: '0',
      rollreason: '',
      full_pool_html: '',
      ...flagValues,
    }
  }

  const getModifierHtml = (key, value) => {
    if (value === 0) {
      return ''
    }

    return `<div>${getTranslationByKey(key)} (${
      value > 0 ? '+' : ''
    }${value})</div>`
  }

  const getDicePoolHtml = (
    rollStyle,
    dicePoolAttributes,
    values,
    useSpecialty,
    useWillpower,
    woundPenalties,
    armorPenalty,
    weaponPenalty,
    modifiers,
  ) => {
    return [
      getSheetDicePoolHtml(dicePoolAttributes, values),
      getModifierHtml('use-specialty', useSpecialty ? 1 : 0),
      getModifierHtml('willpower', useWillpower ? 3 : 0),
      getModifierHtml('wound-penalty', woundPenalties),
      getModifierHtml('armor-penalty', rollStyle === 'attack' ? armorPenalty : 0),
      getModifierHtml(
        'weapon-penalty',
        rollStyle === 'attack' ? weaponPenalty : 0,
      ),
      getModifierHtml('modifiers', modifiers),
    ].join('')
  }

  const generateDiceString = (
    totalDiceToRoll,
    rollType,
    isChanceRoll,
    isRote,
  ) => {
    const targetDifficulty = getTargetDifficulty(isChanceRoll)
    const rerollFailures = getRerollFailures(isRote, targetDifficulty)
    const explodingDice = getExplodingDiceTarget(rollType, isChanceRoll)
    const criticalFail = getCriticalFail(isChanceRoll)
    return `${
      totalDiceToRoll <= 0 ? 1 : totalDiceToRoll
    }d10!>${explodingDice}cs>${targetDifficulty}${rerollFailures}${criticalFail}>${targetDifficulty}`
  }

  const getSuccessType = (totalSuccesses, isChanceRoll, diceResults) => {
    if (totalSuccesses >= 5) {
      return 'dramatic-success'
    }
    if (totalSuccesses >= 1) {
      return 'success'
    }
    if (isChanceRoll && _.every(diceResults, (result) => result === 1)) {
      return 'dramatic-failure'
    }
    return 'failure'
  }

  const getRollTemplate = (rollStyle) => {
    switch (rollStyle) {
      case 'attack':
        return 'wod-attack'
      case 'simple':
        return 'wod-simple'
      default:
        return 'wod'
    }
  }

  const calculateDicePool = (
    rollStyle,
    dicePool,
    useSpecialty,
    useWillpower,
    woundPenalties,
    modifier,
  ) => {
    if (rollStyle === 'simple') {
      return dicePool
    }
    const willpowerDice = useWillpower ? 3 : 0
    const specialtyDice = useSpecialty ? 1 : 0
    return Math.max(
      dicePool + specialtyDice + willpowerDice + modifier + woundPenalties,
      0,
    )
  }

  const getRollString = (rollStyle, totalDiceToRoll, rollType, isRote) => {
    if (rollStyle === 'simple') {
      return `${totalDiceToRoll}d10`
    }
    return generateDiceString(totalDiceToRoll, rollType, false, isRote)
  }

  const rollDicePoolAttributes = [
    ...normalStats,
    'dice_pool_attributes',
    'dice_pool',
    'rolltype_select',
    'rollstyle',
    'rollmodify_rote',
    'rollmodify_willpower',
    'rollmodify_modifier',
    'rollmodify_specialty',
    'rollreason',
    'current_willpower',
    'wound_penalty',
    'armor_penalty',
    'weapon_penalty',
    'character_name',
    'attack_damage',
    'attack_damage_type',
  ]

  on('clicked:roll', () => {
    getAttrs(rollDicePoolAttributes, (v) => {
      const rollStyle = v.rollstyle || 'simple'
      const attributes = (v.dice_pool_attributes || '').split(',')
      if (rollStyle === 'sheet' && attributes.length < 2) {
        return
      }

      const modifier = parseInt(v.rollmodify_modifier) || 0
      const dicePool = parseInt(v.dice_pool) || 0
      const willpower = parseInt(v.current_willpower) || 0
      const useWillpower =
        (parseInt(v.rollmodify_willpower) || 0) === 1 && willpower > 0
      const useSpecialty = (parseInt(v.rollmodify_specialty) || 0) === 1
      const woundPenalties = parseInt(v.wound_penalty) || 0
      const isRote = parseInt(v.rollmodify_rote) === 1
      const rollType = v.rolltype_select || ''
      const armorPenalty = parseInt(v.armor_penalty) || 0
      const weaponPenalty = parseInt(v.weapon_penalty) || 0
      const attackDamage = parseInt(v.attack_damage) || 0
      const attackDmgType =
        getTranslationByKey(`${v.attack_damage_type}-dmg`) || ''

      const totalDiceToRoll = calculateDicePool(
        rollStyle,
        dicePool,
        useSpecialty,
        useWillpower,
        woundPenalties,
        modifier,
      )
      const isChanceRoll = totalDiceToRoll <= 0
      const diceString = generateDiceString(
        totalDiceToRoll,
        rollType,
        isChanceRoll,
        isRote,
      )

      const template = `&{template:${getRollTemplate(v.rollstyle)}}`
      const rollString = `${template} {{name=@{character_name}}} {{dicePool=[[${totalDiceToRoll}]]}} {{dicePoolHtml=@{full_pool_html}}} {{result=[[${diceString}]]}}{{reason=@{rollreason}}} {{rollstyle=@{rollstyle}}} {{isRote=${
        isRote ? 'rote' : ''
      }}} {{successType=[[0]]}} {{9again=${
        !isChanceRoll && rollType === '9-again' ? '9again' : ''
      }}} {{8again=${
        !isChanceRoll && rollType === '8-again' ? '8again' : ''
      }}} {{chance=${
        isChanceRoll ? 'chance' : ''
      }}} {{attack_name=@{attack_name}}} {{attack_damage=@{attack_damage}}} {{attack_damage_type=${attackDmgType}}} {{totalDamage=[[0]]}}`
      setAttrs(
        {
          full_pool_html:
            rollStyle !== 'simple'
              ? getDicePoolHtml(
                  rollStyle,
                  attributes,
                  v,
                  useSpecialty,
                  useWillpower,
                  woundPenalties,
                  armorPenalty,
                  weaponPenalty,
                  modifier,
                )
              : '',
        },
        {},
        () => {
          startRoll(rollString, (results) => {
            if (useWillpower) {
              setAttrs({
                current_willpower: willpower - 1,
              })
            }
            const countSuccesses = results.results.result.result
            const rolls = results.results.result.dice
            const totalDamage = countSuccesses + attackDamage
            console.log(totalDamage)

            finishRoll(results.rollId, {
              successType: getTranslationByKey(
                getSuccessType(countSuccesses, isChanceRoll, rolls),
              ),
              totalDamage: totalDamage,
            })
          })
        },
      )
    })
  })

  const extraTraitCount = 9
  const weaponCount = 6
  const maxTraitCount = Math.max(extraTraitCount, weaponCount)
  const repeatingWeaponTraits = [
    'weapon_name_%d',
    'weapon_damage_%d',
    'weapon_range_%d',
    'weapon_clip_%d',
    'weapon_initiative_%d',
    'weapon_strength_%d',
    'weapon_size_%d',
  ]

  const repeatingV1Attrs = [
    ...[...Array(extraTraitCount).keys()].flatMap((i) => [
      `other_traits_${i + 1}_name`,
      `other_traits_${i + 1}`,
    ]),
    ...[...Array(weaponCount).keys()].flatMap((i) =>
      repeatingWeaponTraits.map((t) => t.replace('%d', i + 1)),
    ),
  ]

  const version1Attrs = [
    'int',
    'res',
    'str',
    'dex',
    'sta',
    'pre',
    'man',
    'com',
    'willpower_available',
    'vitality_dot',
    'vitality_available',
    'shade',
    'lament',
  ]

  const v1AttrMap = {
    int: 'intelligence',
    res: 'resolve',
    str: 'strength',
    dex: 'dexterity',
    sta: 'stamina',
    pre: 'presence',
    man: 'manipulation',
    com: 'composure',
    willpower_available: 'current_willpower',
    vitality_dot: 'vitality',
    vitality_available: 'current_vitality',
    spite_dot: 'spite',
    spite_available: 'current_spite',
    speed_defense: 'armor_speed0',
    armor_strength: 'armor_strength0',
    'armor_defense,': 'armor_defense0',
    armor_text: 'armor_description0',
  }

  const newV1Attr = [
    'iron_stamina',
    'fleet_of_foot',
    'shoot_first',
    'giant',
    'small_framed',
    'defense_bonus',
  ]

  const v0ArmorAttr = [
    'armor_rating',
    'armor_strength',
    'armor_defense,',
    'speed_defense',
    'armor_text',
  ]

  const repeatingV1AttrMap = {
    'other_traits_%d_name': 'extra_trait_%d_name',
    'other_traits_%d': 'extra_trait_%d',
    'weapon_name_%d': 'attack_name%d',
    'weapon_damage_%d': 'attack_damage%d',
    'weapon_range_%d': 'attack_range%d',
    'weapon_clip_%d': 'attack_magazine%d',
    'weapon_initiative_%d': 'attack_initiative%d',
    'weapon_strength_%d': 'attack_strength%d',
    'weapon_size_%d': 'attack_size%d',
  }

  const versionAttrs = [
    'version',
    ...version1Attrs,
    ...repeatingV1Attrs,
    ...v0ArmorAttr,
  ]

  //Upgrade for new sheet versions
  const versionUpdate = () => {
    getAttrs(versionAttrs, (v) => {
      const version = parseInt(v.version) || 0
      let attrs = {}
      if (version < 1) {
        if (v.armor_rating) {
          const [ballistic, general] = v.armor_rating.split('/')
          if (ballistic) {
            attrs['armor_ballistic0'] = ballistic
          }
          if (general) {
            attrs['armor_general0'] = general || ballistic || 0
          }
        }
        //Rename v0 attributes to v1 attributes
        const renamedAttrs = Object.entries(v1AttrMap).reduce(
          (attrs, [oldAttr, newAttr]) => ({
            ...attrs,
            [newAttr]: v[oldAttr] || '',
          }),
          {},
        )
        //Initialise new attributes
        const newAttrs = newV1Attr.reduce(
          (attrs, newAttr) => ({
            ...attrs,
            [newAttr]: 0,
          }),
          {},
        )
        const lamentAndShadeAttrs = {
          shade: v.shade.toLowerCase().replace(' ', ''),
          lament: v.lament.toLowerCase().replace(' ', ''),
        }
        const repeatingAttrs = [...Array(maxTraitCount).keys()].reduce(
          (attrs, i) => {
            const repeatingAttrMap = Object.entries(repeatingV1AttrMap)
              .filter(([oldAttr, _]) => oldAttr.replace('%d', i + 1) in v)
              .reduce((attrs, [oldAttr, newAttr]) => {
                return {
                  ...attrs,
                  [newAttr.replace('%d', i + 1)]: v[oldAttr.replace('%d', i + 1)],
                }
              }, {})
            return {
              ...attrs,
              ...repeatingAttrMap,
            }
          },
          {},
        )
        //Set all attributes
        attrs = {
          ...attrs,
          ...renamedAttrs,
          ...newAttrs,
          ...lamentAndShadeAttrs,
          ...repeatingAttrs,
        }
        attrs['version'] = 1
      }
      console.log('Upgrading for V1:', attrs)
      setAttrs(attrs)
    })
  }

  on('sheet:opened', () => {
    versionUpdate()
    updateHealth()
    updateAttacks()
    updateSpeed()
    updateDefense()
    updateInitiative()
    updateWillpower()
    updateSpecializationVisible()
    const resetRollFlagAttrs = resetRollFlags()

    setAttrs(
      {
        dicepoolmacro: getTranslationByKey('dice-pool'),
        modifiermacro: getTranslationByKey('modifiers'),
        unarmedmacro: getTranslationByKey('unarmed'),
        ...resetRollFlagAttrs,
      },
      { silent: true },
    )
  })

</script>
