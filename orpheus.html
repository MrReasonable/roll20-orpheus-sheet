<input type="radio" name="attr_tab" class="tab tab1" value="1" title="Sheet" checked="checked" />
<input type="radio" name="attr_tab" class="tab tab2" value="2" title="Horrors/Items" />
<input type="radio" name="attr_tab" class="tab tab3" value="3" title="Expanded Merits" />
<input type="radio" name="attr_tab" class="tab tab4" value="4" title="Background" />
<input type="radio" name="attr_tab" class="tab tab5" value="5" title="Settings" />
<div class="tab-br"></div>
<div class="tab-content tab1">
    <div class="tabbed-panel">
        <div>
            <div class="info-grid">
                <!-- Row 1 -->
                <div class="input-label">
                    <span>Name</span>:
                </div>
                <input type="text" name="attr_character_name">
                <div class="spacer"></div>
                <div class="input-label">
                    <span>Virtue</span>:
                </div>
                <input type="text" name="attr_virtue">
                <div class="spacer"></div>
                <div class="input-label">
                    <span>Shade</span>:
                </div>
                <select name="attr_shade" class="select">
                    <option value="none" selected>---</option>
                    <option value="banshee">Banshee</option>
                    <option value="haunter">Haunter</option>
                    <option value="orphan_grinder">Orphan Grinder</option>
                    <option value="phantasm">Phantasm</option>
                    <option value="poltergeist">Poltergeist</option>
                    <option value="skinrider">Skinrider</option>
                    <option value="wisp">Wisp</option>
                    <option value="spectre">Spectre</option>
                </select>
                <!-- Row 2 -->
                <div class="input-label">
                    <span>Player</span>:
                </div>
                <input type="text" name="attr_player_name">
                <div class="spacer"></div>
                <div class="input-label">
                    <span>Vice</span>:
                </div>
                <input type="text" name="attr_vice">
                <div class="spacer"></div>
                <div class="input-label">
                    <span>Company</span>:
                </div>
                <input type="text" name="attr_company">
                <!-- Row 3 -->
                <div class="input-label">
                    <span>Crucible</span>:
                </div>
                <input type="text" name="attr_crucible">
                <div class="spacer"></div>
                <div class="input-label">
                    <span>Concept</span>:
                </div>
                <input type="text" name="attr_concept">
                <div class="spacer"></div>
                <div class="input-label">
                    <span>Lament</span>:
                </div>
                <select name="attr_lament" class="select">
                    <option value="none" selected>---</option>
                    <option value="skimmer">Skimmer</option>
                    <option value="sleeper">Sleeper</option>
                    <option value="spirit">Spirit</option>
                    <option value="hue">Hue</option>
                </select>
            </div>
            <div class="section-header">
                <h2><span>Attributes</span></h2>
            </div>
            <div class="attributes">
                <div class="attributes-category power">Power</div>
                <div class="attributes-category finesse">Finesse</div>
                <div class="attributes-category resistance">Resistance</div>
                <div class="mental border"></div>
                <div class="power mental label">
                    <input type="hidden" class="flag" name="attr_intelligence_flag" value="0" />
                    <button type="action" class="toggle" name="act_intelligence">Intelligence</button>
                </div>
                <div class="power mental dots">
                    <input type="hidden" name="attr_intelligence" value="1" />
                    <button type="action" class="dot zero" name="act_intelligence-0">×</button>
                    <button type="action" class="dot" name="act_intelligence-1"></button>
                    <button type="action" class="dot ne-1" name="act_intelligence-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_intelligence-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_intelligence-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_intelligence-5"></button>
                </div>
                <div class="finesse mental label">
                    <input type="hidden" class="flag" name="attr_wits_flag" value="0" />
                    <button type="action" class="toggle" name="act_wits">Wits</button>
                </div>
                <div class="finesse mental dots">
                    <input type="hidden" name="attr_wits" value="1" />
                    <button type="action" class="dot zero" name="act_wits-0">×</button>
                    <button type="action" class="dot" name="act_wits-1"></button>
                    <button type="action" class="dot ne-1" name="act_wits-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_wits-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_wits-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_wits-5"></button>
                </div>
                <div class="resistance mental label">
                    <input type="hidden" class="flag" name="attr_resolve_flag" value="0" />
                    <button type="action" class="toggle" name="act_resolve">Resolve</button>
                </div>
                <div class="resistance mental dots">
                    <input type="hidden" name="attr_resolve" value="1" />
                    <button type="action" class="dot zero" name="act_resolve-0">×</button>
                    <button type="action" class="dot" name="act_resolve-1"></button>
                    <button type="action" class="dot ne-1" name="act_resolve-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_resolve-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_resolve-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_resolve-5"></button>
                </div>
                <div class="physical border"></div>
                <div class="power physical label">
                    <input type="hidden" class="flag" name="attr_strength_flag" value="0" />
                    <button type="action" class="toggle" name="act_strength">Strength</button>
                </div>
                <div class="power physical dots">
                    <input type="hidden" name="attr_strength" value="1" />
                    <button type="action" class="dot zero" name="act_strength-0">×</button>
                    <button type="action" class="dot" name="act_strength-1"></button>
                    <button type="action" class="dot ne-1" name="act_strength-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_strength-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_strength-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_strength-5"></button>
                </div>
                <div class="finesse physical label">
                    <input type="hidden" class="flag" name="attr_dexterity_flag" value="0" />
                    <button type="action" class="toggle" name="act_dexterity">Dexterity</button>
                </div>
                <div class="finesse physical dots">
                    <input type="hidden" name="attr_dexterity" value="1" />
                    <button type="action" class="dot zero" name="act_dexterity-0">×</button>
                    <button type="action" class="dot" name="act_dexterity-1"></button>
                    <button type="action" class="dot ne-1" name="act_dexterity-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_dexterity-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_dexterity-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_dexterity-5"></button>
                </div>
                <div class="resistance physical label">
                    <input type="hidden" class="flag" name="attr_stamina_flag" value="0" />
                    <button type="action" class="toggle" name="act_stamina">Stamina</button>
                </div>
                <div class="resistance physical dots">
                    <input type="hidden" name="attr_stamina" value="1" />
                    <button type="action" class="dot zero" name="act_stamina-0">×</button>
                    <button type="action" class="dot" name="act_stamina-1"></button>
                    <button type="action" class="dot ne-1" name="act_stamina-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_stamina-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_stamina-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_stamina-5"></button>
                </div>
                <div class="social border"></div>
                <div class="power social label">
                    <input type="hidden" class="flag" name="attr_presence_flag" value="0" />
                    <button type="action" class="toggle" name="act_presence">Presence</button>
                </div>
                <div class="power social dots">
                    <input type="hidden" name="attr_presence" value="1" />
                    <button type="action" class="dot zero" name="act_presence-0">×</button>
                    <button type="action" class="dot" name="act_presence-1"></button>
                    <button type="action" class="dot ne-1" name="act_presence-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_presence-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_presence-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_presence-5"></button>
                </div>
                <div class="finesse social label">
                    <input type="hidden" class="flag" name="attr_manipulation_flag" value="0" />
                    <button type="action" class="toggle" name="act_manipulation">Manipulation</button>
                </div>
                <div class="finesse social dots">
                    <input type="hidden" name="attr_manipulation" value="1" />
                    <button type="action" class="dot zero" name="act_manipulation-0">×</button>
                    <button type="action" class="dot" name="act_manipulation-1"></button>
                    <button type="action" class="dot ne-1" name="act_manipulation-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_manipulation-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_manipulation-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_manipulation-5"></button>
                </div>
                <div class="resistance social label">
                    <input type="hidden" class="flag" name="attr_composure_flag" value="0" />
                    <button type="action" class="toggle" name="act_composure">Composure</button>
                </div>
                <div class="resistance social dots">
                    <input type="hidden" name="attr_composure" value="1" />
                    <button type="action" class="dot zero" name="act_composure-0">×</button>
                    <button type="action" class="dot" name="act_composure-1"></button>
                    <button type="action" class="dot ne-1" name="act_composure-2"></button>
                    <button type="action" class="dot ne-1 ne-2" name="act_composure-3"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_composure-4"></button>
                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_composure-5"></button>
                </div>
            </div>
            <div class="el_spacer"></div>
            <div class="flex">
                <!-- SKILL FIELDS -->
                <div class="skills">
                    <div class="section-header">
                        <h2><span>SKILLS</span></h2>
                    </div>
                    <div class="subheader">
                        <h3>Mental</h3>
                    </div>
                    <div class="subsubheader">(-3 unskilled)</div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_academics_box" value="0">
                            <button type="action" name="act_academics_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_academics_flag" value="0" />
                        <button type="action" class="toggle" name="act_academics">Academics</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_academics" value="0" />
                        <button type="action" class="dot zero" name="act_academics-0">×</button>
                        <button type="action" class="dot" name="act_academics-1"></button>
                        <button type="action" class="dot ne-1" name="act_academics-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_academics-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_academics-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_academics-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox  eq-1">
                            <input type="hidden" class="flag" name="attr_computer_box" value="0">
                            <button type="action" name="act_computer_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_computer_flag" value="0" />
                        <button type="action" class="toggle" name="act_computer">Computer</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_computer" value="0" />
                        <button type="action" class="dot zero" name="act_computer-0">×</button>
                        <button type="action" class="dot" name="act_computer-1"></button>
                        <button type="action" class="dot ne-1" name="act_computer-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_computer-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_computer-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_computer-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_crafts_box" value="0">
                            <button type="action" name="act_crafts_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_crafts_flag" value="0" />
                        <button type="action" class="toggle" name="act_crafts">Crafts</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_crafts" value="0" />
                        <button type="action" class="dot zero" name="act_crafts-0">×</button>
                        <button type="action" class="dot" name="act_crafts-1"></button>
                        <button type="action" class="dot ne-1" name="act_crafts-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_crafts-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_crafts-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_crafts-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox  eq-1">
                            <input type="hidden" class="flag" name="attr_investigation_box" value="0">
                            <button type="action" name="act_investigation_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_investigation_flag" value="0" />
                        <button type="action" class="toggle" name="act_investigation">Investigation</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_investigation" value="0" />
                        <button type="action" class="dot zero" name="act_investigation-0">×</button>
                        <button type="action" class="dot" name="act_investigation-1"></button>
                        <button type="action" class="dot ne-1" name="act_investigation-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_investigation-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_investigation-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_investigation-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_medicine_box" value="0">
                            <button type="action" name="act_medicine_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_medicine_flag" value="0" />
                        <button type="action" class="toggle" name="act_medicine">Medicine</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_medicine" value="0" />
                        <button type="action" class="dot zero" name="act_medicine-0">×</button>
                        <button type="action" class="dot" name="act_medicine-1"></button>
                        <button type="action" class="dot ne-1" name="act_medicine-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_medicine-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_medicine-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_medicine-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_occult_box" value="0">
                            <button type="action" name="act_occult_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_occult_flag" value="0" />
                        <button type="action" class="toggle" name="act_occult">Occult</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_occult" value="0" />
                        <button type="action" class="dot zero" name="act_occult-0">×</button>
                        <button type="action" class="dot" name="act_occult-1"></button>
                        <button type="action" class="dot ne-1" name="act_occult-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_occult-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_occult-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_occult-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_politics_box" value="0">
                            <button type="action" name="act_politics_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_politics_flag" value="0" />
                        <button type="action" class="toggle" name="act_politics">Politics</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_politics" value="0" />
                        <button type="action" class="dot zero" name="act_politics-0">×</button>
                        <button type="action" class="dot" name="act_politics-1"></button>
                        <button type="action" class="dot ne-1" name="act_politics-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_politics-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_politics-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_politics-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_science_box" value="0">
                            <button type="action" name="act_science_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_science_flag" value="0" />
                        <button type="action" class="toggle" name="act_science">Science</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_science" value="0" />
                        <button type="action" class="dot zero" name="act_science-0">×</button>
                        <button type="action" class="dot" name="act_science-1"></button>
                        <button type="action" class="dot ne-1" name="act_science-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_science-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_science-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_science-5"></button>
                    </div>
                    <div class="subheader">
                        <h3>Physical</h3>
                    </div>
                    <div class="subsubheader">(-1 unskilled)</div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_athletics_box" value="0">
                            <button type="action" name="act_athletics_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_athletics_flag" value="0" />
                        <button type="action" class="toggle" name="act_athletics">Athletics</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_athletics" value="0" />
                        <button type="action" class="dot zero" name="act_athletics-0">×</button>
                        <button type="action" class="dot" name="act_athletics-1"></button>
                        <button type="action" class="dot ne-1" name="act_athletics-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_athletics-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_athletics-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_athletics-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_brawl_box" value="0">
                            <button type="action" name="act_brawl_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_brawl_flag" value="0" />
                        <button type="action" class="toggle" name="act_brawl">Brawl</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_brawl" value="0" />
                        <button type="action" class="dot zero" name="act_brawl-0">×</button>
                        <button type="action" class="dot" name="act_brawl-1"></button>
                        <button type="action" class="dot ne-1" name="act_brawl-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_brawl-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_brawl-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_brawl-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_drive_box" value="0">
                            <button type="action" name="act_drive_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_drive_flag" value="0" />
                        <button type="action" class="toggle" name="act_drive">Drive</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_drive" value="0" />
                        <button type="action" class="dot zero" name="act_drive-0">×</button>
                        <button type="action" class="dot" name="act_drive-1"></button>
                        <button type="action" class="dot ne-1" name="act_drive-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_drive-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_drive-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_drive-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_firearms_box" value="0">
                            <button type="action" name="act_firearms_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_firearms_flag" value="0" />
                        <button type="action" class="toggle" name="act_firearms">Firearms</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_firearms" value="0" />
                        <button type="action" class="dot zero" name="act_firearms-0">×</button>
                        <button type="action" class="dot" name="act_firearms-1"></button>
                        <button type="action" class="dot ne-1" name="act_firearms-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_firearms-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_firearms-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_firearms-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_larceny_box" value="0">
                            <button type="action" name="act_larceny_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_larceny_flag" value="0" />
                        <button type="action" class="toggle" name="act_larceny">Larceny</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_larceny" value="0" />
                        <button type="action" class="dot zero" name="act_larceny-0">×</button>
                        <button type="action" class="dot" name="act_larceny-1"></button>
                        <button type="action" class="dot ne-1" name="act_larceny-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_larceny-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_larceny-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_larceny-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_stealth_box" value="0">
                            <button type="action" name="act_stealth_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_stealth_flag" value="0" />
                        <button type="action" class="toggle" name="act_stealth">Stealth</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_stealth" value="0" />
                        <button type="action" class="dot zero" name="act_stealth-0">×</button>
                        <button type="action" class="dot" name="act_stealth-1"></button>
                        <button type="action" class="dot ne-1" name="act_stealth-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_stealth-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_stealth-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_stealth-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_survival_box" value="0">
                            <button type="action" name="act_survival_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_survival_flag" value="0" />
                        <button type="action" class="toggle" name="act_survival">Survival</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_survival" value="0" />
                        <button type="action" class="dot zero" name="act_survival-0">×</button>
                        <button type="action" class="dot" name="act_survival-1"></button>
                        <button type="action" class="dot ne-1" name="act_survival-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_survival-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_survival-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_survival-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_weaponry_box" value="0">
                            <button type="action" name="act_weaponry_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_weaponry_flag" value="0" />
                        <button type="action" class="toggle" name="act_weaponry">Weaponry</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_weaponry" value="0" />
                        <button type="action" class="dot zero" name="act_weaponry-0">×</button>
                        <button type="action" class="dot" name="act_weaponry-1"></button>
                        <button type="action" class="dot ne-1" name="act_weaponry-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_weaponry-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_weaponry-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_weaponry-5"></button>
                    </div>
                    <div class="subheader">
                        <h3>Social</h3>
                    </div>
                    <div class="subsubheader">(-1 unskilled)</div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_animalken_box" value="0">
                            <button type="action" name="act_animalken_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_animalken_flag" value="0" />
                        <button type="action" class="toggle" name="act_animalken">Animal Ken</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_animalken" value="0" />
                        <button type="action" class="dot zero" name="act_animalken-0">×</button>
                        <button type="action" class="dot" name="act_animalken-1"></button>
                        <button type="action" class="dot ne-1" name="act_animalken-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_animalken-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_animalken-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_animalken-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_empathy_box" value="0">
                            <button type="action" name="act_empathy_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_empathy_flag" value="0" />
                        <button type="action" class="toggle" name="act_empathy">Empathy</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_empathy" value="0" />
                        <button type="action" class="dot zero" name="act_empathy-0">×</button>
                        <button type="action" class="dot" name="act_empathy-1"></button>
                        <button type="action" class="dot ne-1" name="act_empathy-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_empathy-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_empathy-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_empathy-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_expression_box" value="0">
                            <button type="action" name="act_expression_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_expression_flag" value="0" />
                        <button type="action" class="toggle" name="act_expression">Expression</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_expression" value="0" />
                        <button type="action" class="dot zero" name="act_expression-0">×</button>
                        <button type="action" class="dot" name="act_expression-1"></button>
                        <button type="action" class="dot ne-1" name="act_expression-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_expression-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_expression-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_expression-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_intimidation_box" value="0">
                            <button type="action" name="act_intimidation_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_intimidation_flag" value="0" />
                        <button type="action" class="toggle" name="act_intimidation">Intimidation</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_intimidation" value="0" />
                        <button type="action" class="dot zero" name="act_intimidation-0">×</button>
                        <button type="action" class="dot" name="act_intimidation-1"></button>
                        <button type="action" class="dot ne-1" name="act_intimidation-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_intimidation-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_intimidation-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_intimidation-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_persuasion_box" value="0">
                            <button type="action" name="act_persuasion_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_persuasion_flag" value="0" />
                        <button type="action" class="toggle" name="act_persuasion">Persuasion</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_persuasion" value="0" />
                        <button type="action" class="dot zero" name="act_persuasion-0">×</button>
                        <button type="action" class="dot" name="act_persuasion-1"></button>
                        <button type="action" class="dot ne-1" name="act_persuasion-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_persuasion-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_persuasion-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_persuasion-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_socialize_box" value="0">
                            <button type="action" name="act_socialize_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_socialize_flag" value="0" />
                        <button type="action" class="toggle" name="act_socialize">Socialize</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_socialize" value="0" />
                        <button type="action" class="dot zero" name="act_socialize-0">×</button>
                        <button type="action" class="dot" name="act_socialize-1"></button>
                        <button type="action" class="dot ne-1" name="act_socialize-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_socialize-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_socialize-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_socialize-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_streetwise_box" value="0">
                            <button type="action" name="act_streetwise_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_streetwise_flag" value="0" />
                        <button type="action" class="toggle" name="act_streetwise">Streetwise</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_streetwise" value="0" />
                        <button type="action" class="dot zero" name="act_streetwise-0">×</button>
                        <button type="action" class="dot" name="act_streetwise-1"></button>
                        <button type="action" class="dot ne-1" name="act_streetwise-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_streetwise-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_streetwise-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_streetwise-5"></button>
                    </div>
                    <div>
                        <input type="hidden" class="if" name="attr_enable_profession">
                        <span class="checkbox eq-1">
                            <input type="hidden" class="flag " name="attr_subterfuge_box" value="0">
                            <button type="action" name="act_subterfuge_box"></button>
                        </span>
                        <input type="hidden" class="flag" name="attr_subterfuge_flag" value="0" />
                        <button type="action" class="toggle" name="act_subterfuge">Subterfuge</button>
                    </div>
                    <div class="dots">
                        <input type="hidden" name="attr_subterfuge" value="0" />
                        <button type="action" class="dot zero" name="act_subterfuge-0">×</button>
                        <button type="action" class="dot" name="act_subterfuge-1"></button>
                        <button type="action" class="dot ne-1" name="act_subterfuge-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_subterfuge-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_subterfuge-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_subterfuge-5"></button>
                    </div>
                </div>
                <div class="horizontal-spacer"></div>
                <!-- OTHER TRAITS -->
                <div class="grow">
                    <div class="section-header">
                        <h2><span>Other Traits</span></h2>
                    </div>
                    <div class="flex">
                        <div class="grow">
                            <div class="columns">
                                <!-- MERITS -->
                                <div>
                                    <div class="subheader">
                                        <h3><span>Merits</span></h3>
                                        </div>
                                        <fieldset class="repeating_merit">
                                        <div class="input-group">
                                            <input type="text" name="attr_merit_name" />
                                            <div class="dots">
                                                <input type="hidden" name="attr_merit" value="0">
                                                <button type="action" class="dot zero" name="act_merit-0">&times;</button>
                                                <button type="action" class="dot" name="act_merit-1"></button>
                                                <button type="action" class="dot ne-1" name="act_merit-2"></button>
                                                <button type="action" class="dot ne-1 ne-2" name="act_merit-3"></button>
                                                <button type="action" class="dot ne-1 ne-2 ne-3" name="act_merit-4"></button>
                                                <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_merit-5"></button>
                                            </div>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div class="columns">
                                <div>
                                    <div class="subheader">
                                        <h3>Horrors</h3>
                                    </div>
                                    <fieldset class="repeating_horror">
                                        <div class="input-group">
                                            <input type="text" name="attr_horrorf" />
                                        </div>
                                    </fieldset>
                                </div>
                                <div class="horizontal-spacer"></div>
                                <div>
                                    <div class="subheader">
                                        <h3>Stains</h3>
                                    </div>
                                    <fieldset class="repeating_stain">
                                        <div class="input-group">
                                            <span>
                                                <input type="hidden" class="flag" name="attr_stain_flag">
                                                <button type="action" class="radio" name="act_stain"></button>
                                            </span>
                                            <input type="hidden" class="flag" name="attr_stain_flag">
                                            <input type="text" name="attr_stain" />
                                        </div>
                                    </fieldset>
                                </div>
                            </div>
                            <div>
                                <div class="el_spacer"></div>
                                <div class="subheader">
                                    <h3>Weapons</h3>
                                </div>
                                <input type="hidden" name="attr_attack"
                                    value="{{attack_name=@{attack_name0}}} {{weapon_damage=@{attack_damage0}}} {{range=@{attack_range0}}} @{attack_type0}">
                                <div class="weapongrid">
                                    <div></div>
                                    <div>Weapon/Attack</div>
                                    <div>Type</div>
                                    <div>Dmg</div>
                                    <div>Range</div>
                                    <div>Mag</div>
                                    <div>Ini</div>
                                    <div>Str</div>
                                    <div>Sz</div>
                                    <div>
                                        <input type="hidden" name="attr_attack_0_value"
                                            value="{{attack_name=@{attack_name0}}} {{weapon_damage=@{attack_damage0}}} {{range=@{attack_range0}}} @{attack_type0}">
                                        <input type="hidden" class="flag" name="attr_attack_0_flag" value="1">
                                        <button type="action" class="radio" name="act_attack_0"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_0_flag" value="1">
                                        <input type="text" name="attr_attack_name0" class="toggle" disabled="disabled" value="unarmed" />
                                        </div>
                                        <div class="selectcontainer">
                                            <select name="attr_attack_type0">
                                                <option
                                                    value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                    Brawl</option>
                                                <option
                                                    value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                    Melee</option>
                                                <option
                                                    value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                    Gun</option>
                                                <option
                                                    value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                    Thrown</option>
                                                <option
                                                    value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                    Brawl* (Fighting Finesse)</option>
                                                <option
                                                    value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                    Melee* (Fighting Finesse)</option>
                                            </select>
                                        </div>
                                        <div><input type="text" name="attr_attack_damage0" value="0" /></div>
                                        <div><input type="text" name="attr_attack_range0" disabled="disabled" value="-" />
                                        </div>
                                    <div><input type="text" name="attr_attack_magazine0" disabled="disabled" value="-" />
                                    </div>
                                    <div><input type="text" name="attr_attack_initiative0" disabled="disabled" value="0" />
                                    </div>
                                    <div><input type="text" name="attr_attack_strength0" disabled="disabled" value="0" />
                                    </div>
                                    <div><input type="text" name="attr_attack_size0" disabled="disabled" value="-" />
                                    </div>
                                    <div>
                                        <input type="hidden" name="attr_attack_1_value"
                                            value="{{attack_name=@{attack_name1}}} {{weapon_damage=@{attack_damage1}}} {{range=@{attack_range1}}} @{attack_type1}">
                                        <input type="hidden" class="flag" name="attr_attack_1_flag" value="0">
                                        <button type="action" class="radio" name="act_attack_1"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_1_flag">
                                        <input type="text" name="attr_attack_name1" class="toggle" />
                                    </div>
                                    <div class="selectcontainer">
                                        <select name="attr_attack_type1">
                                            <option value="{{result=[[{((?{modifiers|0})" checked="checked"></option>
                                            <option
                                                value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl</option>
                                            <option
                                                value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee</option>
                                            <option
                                                value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Gun</option>
                                            <option
                                                value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Thrown</option>
                                            <option
                                                value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl* (Fighting Finesse)</option>
                                            <option
                                                value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee* (Fighting Finesse)</option>
                                        </select>
                                    </div>
                                    <div><input type="text" name="attr_attack_damage1" /></div>
                                    <div><input type="text" name="attr_attack_range1" /></div>
                                    <div><input type="text" name="attr_attack_magazine1" /></div>
                                    <div><input type="text" name="attr_attack_initiative1" /></div>
                                    <div><input type="text" name="attr_attack_strength1" /></div>
                                    <div><input type="text" name="attr_attack_size1" /></div>
                                    <div>
                                        <input type="hidden" name="attr_attack_2_value"
                                            value="{{attack_name=@{attack_name2}}} {{weapon_damage=@{attack_damage2}}} {{range=@{attack_range2}}} @{attack_type2}">
                                        <input type="hidden" class="flag" name="attr_attack_2_flag" value="0">
                                        <button type="action" class="radio" name="act_attack_2"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_2_flag">
                                        <input type="text" name="attr_attack_name2" class="weaponstat name toggle" />
                                    </div>
                                    <div class="selectcontainer">
                                        <select name="attr_attack_type2">
                                            <option value="{{result=[[{((?{modifiers|0})" checked="checked"></option>
                                            <option
                                                value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl</option>
                                            <option
                                                value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee</option>
                                            <option
                                                value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Gun</option>
                                            <option
                                                value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Thrown</option>
                                            <option
                                                value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl* (Fighting Finesse)</option>
                                            <option
                                                value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee* (Fighting Finesse)</option>
                                        </select>
                                    </div>
                                    <div><input type="text" name="attr_attack_damage2" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_range2" class="weaponstat range" /></div>
                                    <div><input type="text" name="attr_attack_magazine2" class="weaponstat mag" /></div>
                                    <div><input type="text" name="attr_attack_initiative2" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_strength2" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_size2" class="weaponstat" /></div>
                                    <div>
                                        <input type="hidden" name="attr_attack_3_value"
                                            value="{{attack_name=@{attack_name3}}} {{weapon_damage=@{attack_damage3}}} {{range=@{attack_range3}}} @{attack_type3}">
                                        <input type="hidden" class="flag" name="attr_attack_3_flag" value="0">
                                        <button type="action" class="radio" name="act_attack_3"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_3_flag">
                                        <input type="text" name="attr_attack_name3" class="weaponstat name toggle" />
                                    </div>
                                    <div class="selectcontainer">
                                        <select name="attr_attack_type3">
                                            <option value="{{result=[[{((?{modifiers|0})" checked="checked"></option>
                                            <option
                                                value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl</option>
                                            <option
                                                value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee</option>
                                            <option
                                                value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Gun</option>
                                            <option
                                                value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Thrown</option>
                                            <option
                                                value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl* (Fighting Finesse)</option>
                                            <option
                                                value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee* (Fighting Finesse)</option>
                                        </select>
                                    </div>
                                    <div><input type="text" name="attr_attack_damage3" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_range3" class="weaponstat range" /></div>
                                    <div><input type="text" name="attr_attack_magazine3" class="weaponstat mag" /></div>
                                    <div><input type="text" name="attr_attack_initiative3" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_strength3" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_size3" class="weaponstat" /></div>
                                    <div>
                                        <input type="hidden" name="attr_attack_4_value"
                                            value="{{attack_name=@{attack_name4}}} {{weapon_damage=@{attack_damage4}}} {{range=@{attack_range4}}} @{attack_type4}">
                                        <input type="hidden" class="flag" name="attr_attack_4_flag" value="0">
                                        <button type="action" class="radio" name="act_attack_4"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_4_flag">
                                        <input type="text" name="attr_attack_name4" class="weaponstat name toggle" />
                                    </div>
                                    <div class="selectcontainer">
                                        <select name="attr_attack_type4">
                                            <option value="{{result=[[{((?{modifiers|0})" checked="checked"></option>
                                            <option
                                                value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl</option>
                                            <option
                                                value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee</option>
                                            <option
                                                value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Gun</option>
                                            <option
                                                value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Thrown</option>
                                            <option
                                                value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl* (Fighting Finesse)</option>
                                            <option
                                                value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee* (Fighting Finesse)</option>
                                        </select>
                                    </div>
                                    <div><input type="text" name="attr_attack_damage4" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_range4" class="weaponstat range" /></div>
                                    <div><input type="text" name="attr_attack_magazine4" class="weaponstat mag" /></div>
                                    <div><input type="text" name="attr_attack_initiative4" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_strength4" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_size4" class="weaponstat" /></div>
                                    <div>
                                        <input type="hidden" name="attr_attack_5_value"
                                            value="{{attack_name=@{attack_name5}}} {{weapon_damage=@{attack_damage5}}} {{range=@{attack_range5}}} @{attack_type5}">
                                        <input type="hidden" class="flag" name="attr_attack_5_flag" value="0">
                                        <button type="action" class="radio" name="act_attack_5"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_5_flag">
                                        <input type="text" name="attr_attack_name5" class="weaponstat name toggle" />
                                    </div>
                                    <div class="selectcontainer">
                                        <select name="attr_attack_type5">
                                            <option value="{{result=[[{((?{modifiers|0})" checked="checked"></option>
                                            <option
                                                value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl</option>
                                            <option
                                                value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee</option>
                                            <option
                                                value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Gun</option>
                                            <option
                                                value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Thrown</option>
                                            <option
                                                value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl* (Fighting Finesse)</option>
                                            <option
                                                value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee* (Fighting Finesse)</option>
                                        </select>
                                    </div>
                                    <div><input type="text" name="attr_attack_damage5" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_range5" class="weaponstat range" /></div>
                                    <div><input type="text" name="attr_attack_magazine5" class="weaponstat mag" /></div>
                                    <div><input type="text" name="attr_attack_initiative5" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_strength5" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_size5" class="weaponstat" /></div>
                                    <div>
                                        <input type="hidden" name="attr_attack_6_value"
                                            value="{{attack_name=@{attack_name6}}} {{weapon_damage=@{attack_damage6}}} {{range=@{attack_range6}}} @{attack_type6}">
                                        <input type="hidden" class="flag" name="attr_attack_6_flag" value="0">
                                        <button type="action" class="radio" name="act_attack_6"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_attack_6_flag">
                                        <input type="text" name="attr_attack_name6" class="weaponstat name toggle" />
                                    </div>
                                    <div class="selectcontainer">
                                        <select name="attr_attack_type6">
                                            <option value="{{result=[[{((?{modifiers|0})" checked="checked"></option>
                                            <option
                                                value="{{str=1}} {{bra=1}} {{result=[[{((@{strength}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl</option>
                                            <option
                                                value="{{str=1}} {{wea=1}} {{result=[[{((@{strength}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee</option>
                                            <option
                                                value="{{dex=1}} {{fir=1}} {{result=[[{((@{dexterity}+@{firearms}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Gun</option>
                                            <option
                                                value="{{dex=1}} {{ath=1}} {{result=[[{((@{dexterity}+@{athletics}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Thrown</option>
                                            <option
                                                value="{{dex=1}} {{bra=1}} {{result=[[{((@{dexterity}+@{brawl}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Brawl* (Fighting Finesse)</option>
                                            <option
                                                value="{{dex=1}} {{wea=1}} {{result=[[{((@{dexterity}+@{weaponry}+?{modifiers|0}+@{wound_penalty}+@{weapon_penalty}+@{armor_penalty})">
                                                Melee* (Fighting Finesse)</option>
                                        </select>
                                    </div>
                                    <div><input type="text" name="attr_attack_damage6" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_range6" class="weaponstat range" /></div>
                                    <div><input type="text" name="attr_attack_magazine6" class="weaponstat mag" /></div>
                                    <div><input type="text" name="attr_attack_initiative6" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_strength6" class="weaponstat" /></div>
                                    <div><input type="text" name="attr_attack_size6" class="weaponstat" /></div>
                                </div>
                                <div class="el_spacer"></div>
                                <div class="subheader">
                                    <h3>Armor</h3>
                                </div>
                                <div class="armorgrid">
                                    <div></div>
                                    <div>Armor</div>
                                    <div>Rating</div>
                                    <div>Str</div>
                                    <div>Def</div>
                                    <div>Spd</div>
                                    <div>Description</div>
                                    <div class="checkbox">
                                        <input type="hidden" name="attr_armor_flag0">
                                        <button type="action" name="act_armor_flag0"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_armor_flag0" value="0">
                                        <input type="text" class="toggle" name="attr_armor_name0" />
                                    </div>
                                    <div><input type="text" name="attr_armor_ballistic0" />/<input type="text" name="attr_armor_general0" /></div>
                                    <div><input type="text" name="attr_armor_strength0" /></div>
                                    <div><input type="text" name="attr_armor_defense0" /></div>
                                    <div><input type="text" name="attr_armor_speed0" /></div>
                                    <div><input type="text" name="attr_armor_description0" /></div>
                                    <div class="checkbox">
                                        <input type="hidden" name="attr_armor_flag1">
                                        <button type="action" name="act_armor_flag1"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_armor_flag1" value="0">
                                        <input type="text" class="toggle" name="attr_armor_name1" />
                                    </div>
                                    <div><input type="text" name="attr_armor_ballistic1" />/<input type="text" name="attr_armor_general1" /></div>
                                    <div><input type="text" name="attr_armor_strength1" /></div>
                                    <div><input type="text" name="attr_armor_defense1" /></div>
                                    <div><input type="text" name="attr_armor_speed1" /></div>
                                    <div><input type="text" name="attr_armor_description1" /></div>
                                    <div class="checkbox">
                                        <input type="hidden" name="attr_armor_flag2">
                                        <button type="action" name="act_armor_flag2"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_armor_flag2" value="0">
                                        <input type="text" class="toggle" name="attr_armor_name2" />
                                    </div>
                                    <div><input type="text" name="attr_armor_ballistic2" />/<input type="text" name="attr_armor_general2" /></div>
                                    <div><input type="text" name="attr_armor_strength2" /></div>
                                    <div><input type="text" name="attr_armor_defense2" /></div>
                                    <div><input type="text" name="attr_armor_speed2" /></div>
                                    <div><input type="text" name="attr_armor_description2" /></div>
                                    <div class="checkbox">
                                        <input type="hidden" name="attr_armor_flag3">
                                        <button type="action" name="act_armor_flag3"></button>
                                    </div>
                                    <div>
                                        <input type="hidden" class="flag" name="attr_armor_flag3" value="0">
                                        <input type="text" class="toggle" name="attr_armor_name3" />
                                    </div>
                                    <div><input type="text" name="attr_armor_ballistic3" />/<input type="text" name="attr_armor_general3" /></div>
                                    <div><input type="text" name="attr_armor_strength3" /></div>
                                    <div><input type="text" name="attr_armor_defense3" /></div>
                                    <div><input type="text" name="attr_armor_speed3" /></div>
                                    <div><input type="text" name="attr_armor_description3" /></div>
                                    </div>
                                    </div>
                                    </div>
                                    <div class="horizontal-spacer"></div>
                                    <div>
                                        <div class="subheader">
                                            <h3>Health</h5>
                                        </div>
                            <div>
                                <div class="healthboxes">
                                    <input type="hidden" name="attr_health" class="if" value="0" />
                                    <div class="healthbox ne-0">
                                        <input type="hidden" name="attr_healthbox_1" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_1"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1">
                                        <input type="hidden" name="attr_healthbox_2" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_2"></button>
                                    </div>
                                    <div class="healthbox ne-1 ne-2">
                                        <input type="hidden" name="attr_healthbox_3" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_3"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3">
                                        <input type="hidden" name="attr_healthbox_4" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_4"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4">
                                        <input type="hidden" name="attr_healthbox_5" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_5"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5">
                                        <input type="hidden" name="attr_healthbox_6" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_6"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6">
                                        <input type="hidden" name="attr_healthbox_7" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_7"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7">
                                        <input type="hidden" name="attr_healthbox_8" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_8"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8">
                                        <input type="hidden" name="attr_healthbox_9" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_9"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9">
                                        <input type="hidden" name="attr_healthbox_10" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_10"></button>
                                    </div>
                                    <div class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10">
                                        <input type="hidden" name="attr_healthbox_11" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_11"></button>
                                    </div>
                                    <div
                                        class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11">
                                        <input type="hidden" name="attr_healthbox_12" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_12"></button>
                                    </div>
                                    <div
                                        class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12">
                                        <input type="hidden" name="attr_healthbox_13" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_13"></button>
                                    </div>
                                    <div
                                        class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13">
                                        <input type="hidden" name="attr_healthbox_14" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_14"></button>
                                    </div>
                                    <div
                                        class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14">
                                        <input type="hidden" name="attr_healthbox_15" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_15"></button>
                                    </div>
                                    <div
                                        class="healthbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14 ne-15">
                                        <input type="hidden" name="attr_healthbox_16" value="0" />
                                        <button type="action" class="damage" name="act_healthbox_16"></button>
                                    </div>
                                    </div>
                                <div class="dots">
                                    <input type="hidden" name="attr_health" class="if" />
                                    <div
                                        class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14 ne-15">
                                    </div>
                                    <div
                                        class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ne-14">
                                    </div>
                                    <div
                                        class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13">
                                    </div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12">
                                    </div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11">
                                    </div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10">
                                    </div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9">
                                    </div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8"></div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6 ne-7"></div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5 ne-6"></div>
                                    <div class="healthbox ne-2 ne-3 ne-4 ne-5"></div>
                                    <div class="healthbox ne-2 ne-3 ne-4"></div>
                                    <div class="healthbox ne-2 ne-3"></div>
                                    <span class="healthbox ne-2" name="attr_wound_penalty_1">-1</span>
                                    <span class="healthbox" name="attr_wound_penalty_2">-2</span>
                                    <span class="healthbox" name="attr_wound_penalty_3">-3</span>
                                </div>
                                </div>
                                <div class="el_spacer"></div>
                                <div>
                                    <div class="subheader">
                                        <h3>Willpower</h3>
                                    </div>
                                <div class="checkboxes">
                                    <input type="hidden" name="attr_willpower" class="if" value="0" />
                                    <input type="hidden" name="attr_current_willpower" class="checked-if" value="0" />
                                    <div class="checkbox ne-0 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2 ge-1">
                                        <button type="action" name="act_willpower_box1"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2">
                                        <button type="action" name="act_willpower_box2"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3">
                                        <button type="action" name="act_willpower_box3"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4">
                                        <button type="action" name="act_willpower_box4"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5">
                                        <button type="action" name="act_willpower_box5"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ge-10 ge-9 ge-8 ge-7 ge-6">
                                        <button type="action" name="act_willpower_box6"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ge-10 ge-9 ge-8 ge-7">
                                        <button type="action" name="act_willpower_box7"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ge-10 ge-9 ge-8">
                                        <button type="action" name="act_willpower_box8"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ge-10 ge-9">
                                        <button type="action" name="act_willpower_box9"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ge-10">
                                        <button type="action" name="act_willpower_box10"></button>
                                    </div>
                                </div>
                                </div>
                            <div class="el-spacer"></div>
                            <input type="hidden" name="attr_shade" class="shade-if" value="spectre" />
                            <div class="ne-spectre">
                                <div class="subheader">
                                    <h3>Vitality</h3>
                                </div>
                                <div class="checkboxes">
                                    <input type="hidden" name="attr_vitality" class="highlighted-if" value="" />
                                    <input type="hidden" name="attr_current_vitality" class="checked-if" value="0" />
                                    <input type="hidden" name="attr_lament" class="lament-if" value="hue" />
                                    <input type="hidden" name="attr_luminous" class="luminous-if" value="0" />
                                    <div
                                        class="checkbox ne-0 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2 ge-1">
                                        <button type="action" name="act_vitality_box1"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2">
                                        <button type="action" name="act_vitality_box2"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3">
                                        <button type="action" name="act_vitality_box3"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4">
                                        <button type="action" name="act_vitality_box4"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5">
                                        <button type="action" name="act_vitality_box5"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7 ge-6">
                                        <button type="action" name="act_vitality_box6"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ge-7">
                                        <button type="action" name="act_vitality_box7"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ge-8 ne-hue">
                                        <button type="action" name="act_vitality_box8"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ge-9 ne-hue">
                                        <button type="action" name="act_vitality_box9"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ge-15 ge-14 ge-13 ge-12 ge-11 ge-10 ne-hue">
                                        <button type="action" name="act_vitality_box10"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ge-15 ge-14 ge-13 ge-12 ge-11 ne-hue luminous ne-luminous-0">
                                        <button type="action" name="act_vitality_box11"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ge-15 ge-14 ge-13 ge-12 ne-hue luminous ne-luminous-0 ne-luminous-1">
                                        <button type="action" name="act_vitality_box12"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12  ge-15 ge-14 ge-13 ne-hue luminous ne-luminous-0 ne-luminous-1 ne-luminous-2">
                                        <button type="action" name="act_vitality_box13"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ne-10 ne-11 ne-12 ne-13 ge-15 ge-14 ne-hue luminous ne-luminous-0 ne-luminous-1 ne-luminous-2 ne-luminous-3">
                                        <button type="action" name="act_vitality_box14"></button>
                                    </div>
                                    <div
                                        class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9  ne-10 ne-11 ne-12 ne-13 ne-14 ge-15 luminous ne-luminous-0 ne-luminous-1 ne-luminous-2 ne-luminous-3 ne-luminous-4">
                                        <button type="action" name="act_vitality_box15"></button>
                                    </div>
                                </div>
                            </div>
                            <div class="el_spacer"></div>
                            <div>
                                <div class="subheader">
                                    <h3>Spite</h3>
                                </div>
                                <div class="healthboxes">
                                    <input type="hidden" name="attr_spite" />
                                    <button type="action" class="dot zero" name="act_spite-0">×</button>
                                    <button type="action" class="dot" name="act_spite-1"></button>
                                    <button type="action" class="dot ne-1" name="act_spite-2"></button>
                                    <button type="action" class="dot ne-1 ne-2" name="act_spite-3"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3" name="act_spite-4"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_spite-5"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5" name="act_spite-6"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6" name="act_spite-7"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7" name="act_spite-8"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8" name="act_spite-9"></button>
                                    <button type="action" class="dot ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9" name="act_spite-10"></button>
                                    <button type="action" class="dot zero" name="act_spite-0">×</button>
                                </div>
                                <div class="checkboxes">
                                    <input type="hidden" name="attr_current_spite" class="checked-if" value="0" />
                                    <div class="checkbox ne-0 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2 ge-1">
                                        <button type="action" name="act_spite_box1"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3 ge-2">
                                        <button type="action" name="act_spite_box2"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4 ge-3">
                                        <button type="action" name="act_spite_box3"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5 ge-4">
                                        <button type="action" name="act_spite_box4"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ge-10 ge-9 ge-8 ge-7 ge-6 ge-5">
                                        <button type="action" name="act_spite_box5"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ge-10 ge-9 ge-8 ge-7 ge-6">
                                        <button type="action" name="act_spite_box6"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ge-10 ge-9 ge-8 ge-7">
                                        <button type="action" name="act_spite_box7"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ge-10 ge-9 ge-8">
                                        <button type="action" name="act_spite_box8"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ge-10 ge-9">
                                        <button type="action" name="act_spite_box9"></button>
                                    </div>
                                    <div class="checkbox ne-0 ne-1 ne-2 ne-3 ne-4 ne-5 ne-6 ne-7 ne-8 ne-9 ge-10">
                                        <button type="action" name="act_spite_box10"></button>
                                    </div>
                                </div>
                            </div>
                            <div class="el-spacer"></div>
                            <div>
                                <div class="subheader">
                                    <h3>Derived</h3>
                                </div>
                                <div class="derived">
                                    <span>Size</span>:<input type="number" name="attr_size" value="@{base_size}+@{giant}-@{small_framed}"
                                        disabled="disabled" />
                                </div>
                                <div class="derived">
                                    <span>Speed</span>:<input type="number" name="attr_speed"
                                        value="@{species_factor}+@{speed_base}+@{speed_penalty}+@{fleet_of_foot}"
                                        disabled="disabled" />
                                </div>
                                <div class="derived">
                                    <span>Defense</span>:<input type="number" name="attr_defense" value="@{defense_base}+@{defense_penalty}"
                                        disabled="disabled" />
                                </div>
                                <div class="derived">
                                    <span>Armor</span>:<input type="number" name="attr_balistic_armor_display" value="@{balistic_armor}"
                                        disabled="disabled" />/<input type="number" name="attr_general_armor_display" value="@{general_armor}"
                                        disabled="disabled" />
                                </div>
                                <div class="derived">
                                    <span>Initiative</span>:<input type="number" name="attr_initiative"
                                        value="@{initiative_base}+@{initiative_penalty}+@{fast_reflexes}"
                                        disabled="disabled" />
                                </div>
                            </div>
                            <div class="input-group">
                                <span>Experience</span>
                                <span>:</span>
                                <input type="text" name="attr_experience">
                            </div>
                            <div>
                                <div class="subheader">
                                    <h5><span>Aspirations</span></h5>
                                </div>
                                <div class="textboxes">
                                    <input type="text" name="attr_aspirations">
                                    <input type="text" name="attr_aspirations2">
                                    <input type="text" name="attr_aspirations3">
                                    </div>
                            </div>
                        </div>
                        </div>
                </div>
            </div>
            </div>
            </div>
</div>
<div class="tab-content tab2">
    <div class="tabbed-panel">
        <div class="section-header">
            <h2><span>Extra Traits</span></h2>
        </div>
        <div class="columns">
            <div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_1_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_1" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_1-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_1-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_1-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_1-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_1-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_1-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_2_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_2" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_2-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_2-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_2-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_2-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_2-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_2-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_3_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_3" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_3-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_3-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_3-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_3-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_3-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_3-5"></button>
                    </div>
                </div>
            </div>
            <div class="horizontal-spacer"></div>
            <div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_4_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_4" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_4-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_4-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_4-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_4-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_4-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_4-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_5_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_5" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_5-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_5-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_5-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_5-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_5-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_5-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_6_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_6" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_6-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_6-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_6-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_6-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_6-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_6-5"></button>
                    </div>
                </div>
            </div>
            <div class="horizontal-spacer"></div>
            <div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_7_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_7" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_7-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_7-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_7-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_7-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_7-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_7-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_8_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_8" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_8-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_8-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_8-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_8-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_8-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_8-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_extra_trait_9_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_extra_trait_9" value="0">
                        <button type="action" class="dot zero" name="act_extra_trait_9-0">&times;</button>
                        <button type="action" class="dot" name="act_extra_trait_9-1"></button>
                        <button type="action" class="dot ne-1" name="act_extra_trait_9-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_extra_trait_9-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_extra_trait_9-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_extra_trait_9-5"></button>
                    </div>
                </div>
            </div>
            </div>
        <div>
            <div class="subheader">
                <h2><span>Horror Usage</span></h2>
            </div>
            <div class='sheet-2colrow'>
                <div class='sheet-col'>
                    <table class="devotions" style="width:100%">
                        <tr class="horror_use_desc">
                            <td>Horror</td>
                            <td><input type="text" name="attr_horror_name_1" /></td>
                            <td>Cost</td>
                            <td><input type="text" name="attr_horror_cost_1" /><br></td>
                        </tr>
                        <tr>
                            <td colspan="4"><textarea name="attr_horror_use_text_1" rows="3" wrap="soft" style="width:97%"
                                    placeholder="Description"></textarea></td>
                        </tr>
                        <tr>
                            <td>Dice Pool</td>
                            <td><input type="text" name="attr_horror_dice_pool_1" /></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Duration</td>
                            <td><input type="text" name="attr_horror_use_duration_1" /></td>
                            <td>Action</td>
                            <td><input type="text" name="attr_horror_use_action_1" /></td>
                        </tr>
                    </table>
                    <br>
                    <table class="devotions" style="width:100%">
                        <tr class="horror_use_desc">
                            <td>Horror</td>
                            <td><input type="text" name="attr_horror_name_2" /></td>
                            <td>Cost</td>
                            <td><input type="text" name="attr_horror_cost_2" /><br></td>
                        </tr>
                        <tr>
                            <td colspan="4"><textarea name="attr_horror_use_text_2" rows="3" wrap="soft" style="width:97%"
                                    placeholder="Description"></textarea></td>
                        </tr>
                        <tr>
                            <td>Dice Pool</td>
                            <td><input type="text" name="attr_horror_dice_pool_2" /></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Duration</td>
                            <td><input type="text" name="attr_horror_use_duration_2" /></td>
                            <td>Action</td>
                            <td><input type="text" name="attr_horror_use_action_2" /></td>
                        </tr>
                    </table>
                    <br>
                    <table class="devotions" style="width:100%">
                        <tr class="horror_use_desc">
                            <td>Horror</td>
                            <td><input type="text" name="attr_horror_name_3" /></td>
                            <td>Cost</td>
                            <td><input type="text" name="attr_horror_cost_3" /><br></td>
                        </tr>
                        <tr>
                            <td colspan="4"><textarea name="attr_horror_use_text_3" rows="3" wrap="soft" style="width:97%"
                                    placeholder="Description"></textarea></td>
                        </tr>
                        <tr>
                            <td>Dice Pool</td>
                            <td><input type="text" name="attr_horror_dice_pool_3" /></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Duration</td>
                            <td><input type="text" name="attr_horror_use_duration_3" /></td>
                            <td>Action</td>
                            <td><input type="text" name="attr_horror_use_action_3" /></td>
                        </tr>
                    </table>
                </div>
                <div class='sheet-col'>
                    <table class="devotions" style="width:100%">
                        <tr class="horror_use_desc">
                            <td>Horror</td>
                            <td><input type="text" name="attr_horror_name_4" /></td>
                            <td>Cost</td>
                            <td><input type="text" name="attr_horror_cost_4" /></td>
                        </tr>
                        <tr>
                            <td colspan="4"><textarea name="attr_horror_use_text_4" rows="3" wrap="soft" style="width:97%"
                                    placeholder="Description"></textarea></td>
                        </tr>
                        <tr>
                            <td>Dice Pool</td>
                            <td><input type="text" name="attr_horror_dice_pool_4" /></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Duration</td>
                            <td><input type="text" name="attr_horror_use_duration_4" /></td>
                            <td>Action</td>
                            <td><input type="text" name="attr_horror_use_action_4" /></td>
                        </tr>
                    </table>
                    <br>
                    <table class="devotions" style="width:100%">
                        <tr class="horror_use_desc">
                            <td>Horror</td>
                            <td><input type="text" name="attr_horror_name_5" /></td>
                            <td>Cost</td>
                            <td><input type="text" name="attr_horror_cost_5" /><br></td>
                        </tr>
                        <tr>
                            <td colspan="4"><textarea name="attr_horror_use_text_5" rows="3" wrap="soft" style="width:97%"
                                    placeholder="Description"></textarea></td>
                        </tr>
                        <tr>
                            <td>Dice Pool</td>
                            <td><input type="text" name="attr_horror_dice_pool_5" /></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Duration</td>
                            <td><input type="text" name="attr_horror_use_duration_5" /></td>
                            <td>Action</td>
                            <td><input type="text" name="attr_horror_use_action_5" /></td>
                        </tr>
                    </table>
                    <br>
                    <table class="devotions" style="width:100%">
                        <tr class="horror_use_desc">
                            <td>Horror</td>
                            <td><input type="text" name="attr_horror_name_6" /></td>
                            <td>Cost</td>
                            <td><input type="text" name="attr_horror_cost_6" /><br></td>
                        </tr>
                        <tr>
                            <td colspan="4"><textarea name="attr_horror_use_text_6" rows="3" wrap="soft" style="width:97%"
                                    placeholder="Description"></textarea></td>
                        </tr>
                        <tr>
                            <td>Dice Pool</td>
                            <td><input type="text" name="attr_horror_dice_pool_6" /></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Duration</td>
                            <td><input type="text" name="attr_horror_use_duration_6" /></td>
                            <td>Action</td>
                            <td><input type="text" name="attr_horror_use_action_6" /></td>
                        </tr>
                    </table>
                </div>
                </div>
        </div>
        <div class="section-header">
            <h2><span>Artifacts</span></h2>
        </div>
        <div class="columns">
            <div>
                <div class="input-group">
                    <input type="text" name="attr_artifact_1_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_artifact_1" value="0">
                        <button type="action" class="dot zero" name="act_artifact_1-0">&times;</button>
                        <button type="action" class="dot" name="act_artifact_1-1"></button>
                        <button type="action" class="dot ne-1" name="act_artifact_1-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_artifact_1-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_1-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_1-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_artifact_2_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_artifact_2" value="0">
                        <button type="action" class="dot zero" name="act_artifact_2-0">&times;</button>
                        <button type="action" class="dot" name="act_artifact_2-1"></button>
                        <button type="action" class="dot ne-1" name="act_artifact_2-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_artifact_2-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_2-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_2-5"></button>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" name="attr_artifact_3_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_artifact_3" value="0">
                        <button type="action" class="dot zero" name="act_artifact_3-0">&times;</button>
                        <button type="action" class="dot" name="act_artifact_3-1"></button>
                        <button type="action" class="dot ne-1" name="act_artifact_3-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_artifact_3-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_3-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_3-5"></button>
                    </div>
                </div>
            </div>
            <div class="horizontal-spacer"></div>
            <div>
                <div class="input-group">
                    <input type="text" name="attr_artifact_4_name" />
                    <div class="dots">
                        <input type="hidden" name="attr_artifact_4" value="0">
                        <button type="action" class="dot zero" name="act_artifact_4-0">&times;</button>
                        <button type="action" class="dot" name="act_artifact_4-1"></button>
                        <button type="action" class="dot ne-1" name="act_artifact_4-2"></button>
                        <button type="action" class="dot ne-1 ne-2" name="act_artifact_4-3"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_4-4"></button>
                        <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_4-5"></button>
                    </div>
                    </div>
                    <div class="input-group">
                        <input type="text" name="attr_artifact_5_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_5" value="0">
                            <button type="action" class="dot zero" name="act_artifact_5-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_5-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_5-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_5-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_5-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_5-5"></button>
                        </div>
                    </div>
                    <div class="input-group">
                        <input type="text" name="attr_artifact_6_name" />
                        <div class="dots">
                            <input type="hidden" name="attr_artifact_6" value="0">
                            <button type="action" class="dot zero" name="act_artifact_6-0">&times;</button>
                            <button type="action" class="dot" name="act_artifact_6-1"></button>
                            <button type="action" class="dot ne-1" name="act_artifact_6-2"></button>
                            <button type="action" class="dot ne-1 ne-2" name="act_artifact_6-3"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_6-4"></button>
                            <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_6-5"></button>
                        </div>
                    </div>
                    </div>
                    <div class="horizontal-spacer"></div>
                    <div>
                        <div class="input-group">
                            <input type="text" name="attr_artifact_7_name" />
                            <div class="dots">
                                <input type="hidden" name="attr_artifact_7" value="0">
                                <button type="action" class="dot zero" name="act_artifact_7-0">&times;</button>
                                <button type="action" class="dot" name="act_artifact_7-1"></button>
                                <button type="action" class="dot ne-1" name="act_artifact_7-2"></button>
                                <button type="action" class="dot ne-1 ne-2" name="act_artifact_7-3"></button>
                                <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_7-4"></button>
                                <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_7-5"></button>
                            </div>
                        </div>
                        <div class="input-group">
                            <input type="text" name="attr_artifact_8_name" />
                            <div class="dots">
                                <input type="hidden" name="attr_artifact_8" value="0">
                                <button type="action" class="dot zero" name="act_artifact_8-0">&times;</button>
                                <button type="action" class="dot" name="act_artifact_8-1"></button>
                                <button type="action" class="dot ne-1" name="act_artifact_8-2"></button>
                                <button type="action" class="dot ne-1 ne-2" name="act_artifact_8-3"></button>
                                <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_8-4"></button>
                                <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_8-5"></button>
                            </div>
                        </div>
                        <div class="input-group">
                            <input type="text" name="attr_artifact_9_name" />
                            <div class="dots">
                                <input type="hidden" name="attr_artifact_9" value="0">
                                <button type="action" class="dot zero" name="act_artifact_9-0">&times;</button>
                                <button type="action" class="dot" name="act_artifact_9-1"></button>
                                <button type="action" class="dot ne-1" name="act_artifact_9-2"></button>
                                <button type="action" class="dot ne-1 ne-2" name="act_artifact_9-3"></button>
                                <button type="action" class="dot ne-1 ne-2 ne-3" name="act_artifact_9-4"></button>
                                <button type="action" class="dot ne-1 ne-2 ne-3 ne-4" name="act_artifact_9-5"></button>
                            </div>
                        </div>
            </div>
        </div>
        </div>
</div>
<div class="tab-content tab3">
    <div class="tabbed-panel">
        <div class="row-panel">
            <div class="center">
                <h2><span>Expanded Merits</span></h2>
            </div>
            <div class='sheet-2colrow'>
                <div class='sheet-col'>
                    <div class="center">
                        <h3>Allies</h3>
                    </div>
                    <textarea name="attr_allies_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_allies_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_allies_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Contacts</h3>
                    </div>
                    <textarea name="attr_contacts_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_contacts_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_contacts_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Mystery Cult</h3>
                    </div>
                    <textarea name="attr_cult_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_cult_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_cult_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Mentor</h3>
                    </div>
                    <textarea name="attr_mentor_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_mentor_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_mentor_3" rows="3" wrap="soft" style="width:100%"></textarea>
                </div>
                <div class='sheet-col'>
                    <div class="center">
                        <h3>Resources</h3>
                    </div>
                    <textarea name="attr_resources_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_resources_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_resources_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Retainer</h3>
                    </div>
                    <textarea name="attr_retainer_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_retainer_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_retainer_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Status</h3>
                    </div>
                    <textarea name="attr_status_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_status_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_status_3" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center"><input type="text" name="attr_expanded_other_merit" placeholder="Other" />
                    </div>
                    <textarea name="attr_expanded_other_merit_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_expanded_other_merit_2" rows="3" wrap="soft" style="width:100%"></textarea>
                    <textarea name="attr_expanded_other_merit_3" rows="3" wrap="soft" style="width:100%"></textarea>
                </div>
                </div>
                <div class="center">
                <h2><span>Possessions</span></h2>
            </div>
            <div class='sheet-2colrow'>
                <div class='sheet-col'>
                    <div class="center">
                        <h3>Gear (carried)</h3>
                    </div>
                    <textarea name="attr_gear_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Vehicles</h3>
                    </div>
                    <textarea name="attr_vehicles_1" rows="3" wrap="soft" style="width:100%"></textarea>
                </div>
                <div class='sheet-col'>
                    <div class="center">
                        <h3>Equipment (owned)</h3>
                    </div>
                    <textarea name="attr_equipment_1" rows="3" wrap="soft" style="width:100%"></textarea>
                    <div class="center">
                        <h3>Misc</h3>
                    </div>
                    <textarea name="attr_misc_1" rows="3" wrap="soft" style="width:100%"></textarea>
                </div>
            </div>
            <div class="center">
                <h2><span>Sanctuary</span></h2>
            </div>
            <table style="width:70%">
                <tr>
                    <th class="center">Location</th>
                    <th colspan="4" class="left">Description</th>
                </tr>
                <tr>
                    <td><input type="text" name="attr_location_1" /></td>
                    <td colspan="4"><input type="text" name="attr_description_1" style="width:100%" /></td>
                </tr>
                <tr>
                    <td><input type="text" name="attr_location_2" /></td>
                    <td colspan="4"><input type="text" name="attr_description_2" style="width:100%" /></td>
                </tr>
                <tr>
                    <td><input type="text" name="attr_location_3" /></td>
                    <td colspan="4"><input type="text" name="attr_description_3" style="width:100%" /></td>
                </tr>
                </table>
                </div>
                </div>
</div>
<div class="tab-content tab4">
    <div class="tabbed-panel">
        <div class="row-panel">
            <div class="center">
                <h2><span>History</span></h2>
            </div>
            <textarea name="attr_history" rows="3" wrap="soft" style="width:99%"></textarea>
            <br>
            <div class="center">
                <h2><span>Description</span></h2>
            </div>
            <textarea name="attr_description" rows="3" wrap="soft" style="width:99%"></textarea>
            <br>
            <table class="grid">
                <tr>
                    <th class="right">Age</th>
                    <td><input type="text" name="attr_age" /></td>
                </tr>
                <tr>
                    <th class="right">Apparent Age</th>
                    <td><input type="text" name="attr_apparent-age" /></td>
                </tr>
                <tr>
                    <th class="right">Date of Birth</th>
                    <td><input type="text" name="attr_date_of_birth" /></td>
                </tr>
                <tr>
                    <th class="right">R.I.P.</th>
                    <td><input type="text" name="attr_rip" /></td>
                </tr>
                <tr>
                    <th class="right">Hair</th>
                    <td><input type="text" name="attr_hair" /></td>
                </tr>
                <tr>
                    <th class="right">Eyes</th>
                    <td><input type="text" name="attr_eyes" /></td>
                </tr>
                <tr>
                    <th class="right">Race</th>
                    <td><input type="text" name="attr_race" /></td>
                </tr>
                <tr>
                    <th class="right">Nationality</th>
                    <td><input type="text" name="attr_nationality" /></td>
                </tr>
                <tr>
                    <th class="right">Height</th>
                    <td><input type="text" name="attr_height" /></td>
                </tr>
                <tr>
                    <th class="right">Weight</th>
                    <td><input type="text" name="attr_weight" /></td>
                </tr>
                <tr>
                    <th class="right">Gender</th>
                    <td><input type="text" name="attr_gender" /></td>
                </tr>
                <tr>
                    <th class="right">Sexual Orientation</th>
                    <td><input type="text" name="attr_sexual_orientation" /></td>
                </tr>
                </table>
                </div>
                </div>
</div>
<div class="tab-content tab5">
    <div class="tabbed-panel">
        <div class="row-panel">
            <div class="center">
                <h2><span>Settings</span></h2>
            </div>
            <div>
                <h3>Defense Settings</h3>
                <span>Defense Trait</span>: <select name="attr_defense_attr">
                    <option value="lowest" selected>Lowest</option>
                    <option value="highest">Highest</option>
                    <option value="wits">Wits</option>
                    <option value="dexterity">Dexterity</option>
                </select>
                <select name="attr_defense_skill">
                    <option value="nothing"></option>
                    <option value="athletics" selected>+ Athletics</option>
                    <option value="brawl">+ Brawl</option>
                    <option value="weaponry">+ Weaponry</option>
                </select>
                <span>Defense Bonus</span>: <input type="number" name="attr_defense_bonus" value="0" />
                <div>
                    <h3>Health Settings</h3>
                    <span>Base Size</span>: <input type="number" name="attr_base_size" value="5" />
                    <span class="checkbox">
                        <input type="hidden" class="flag" name="attr_giant" value="0">
                        <button type="action" name="act_giant"></button>
                        <button type="action" class="toggle" name="act_giant">Giant</button>
                    </span>
                    <span class="checkbox">
                        <input type="hidden" class="flag" name="attr_small_framed" value="0">
                        <button type="action" name="act_small_framed"></button>
                        <button type="action" class="toggle" name="act_small_framed">Small Framed</button>
                    </span>
                    <br>
                    <span>Iron Stamina</span>: <input type="number" name="attr_iron_stamina" value="0" />
                    </div>
                    <div>
                        <h3>Speed Settings</h3>
                        <span>Species Factor</span>:<input type="number" name="attr_species_factor" value="5" />
                        <span>Fleet of Foot</span>: <input type="number" name="attr_fleet_of_foot" style="width: 55px;" value="0" />
                    </div>
                    <div>
                        <h3>Initiative Settings</h3>
                    <span>Fast Reflexes</span>: <input type="number" name="attr_fast_reflexes" value="0" />
                    <span class="checkbox">
                        <input type="hidden" class="flag" name="attr_shoot_first" value="0">
                        <button type="action" name="act_shoot_first"></button>
                        <button type="action" class="toggle" name="act_shoot_first">Shoot First</button>
                    </span>
                    <span>Initiative Bonus</span>: <input type="number" name="attr_initiative_bonus" value="0" />
                </div>
                <div>
                    <h3>Vitality Settings</h3>
                    <span>Vitality Rating</span>: <input type="number" name="attr_vitality" value="6" />
                    <span>Luminous</span>: <input type="number" name="attr_luminous" value="0" />
                </div>
                <div>
                    <h3>Sheet Settings</h3>
                    <span class="checkbox">
                        <input type="hidden" class="flag" name="attr_enable_profession" value="0">
                        <button type="action" name="act_enable_profession"></button>
                        <button type="action" class="toggle" name="act_enable_profession">Enable checkboxes next to skills (Normally used for
                            professions, rote skills, etc)</button>
                        </span>
                        </div>
                        </div>
                        </div>
                        </div>
</div>
<!-- HIDDEN FIELDS AND FORMULAS -->
<input type="hidden" name="attr_version" value="0" />
<input type="hidden" name="attr_health" value="0" />
<input type="hidden" name="attr_speed_base" value="0" />
<input type="hidden" name="attr_speed_penalty" value="" />
<input type="hidden" name="attr_defense_base" value="0" />
<input type="hidden" name="attr_defense_penalty" value="0" />
<input type="hidden" name="attr_initiative_penalty" value="0" />
<input type="hidden" name="attr_initiative_base" value="0" />
<input type="hidden" name="attr_balistic_armor"
    value="((@{armor_ballistic0}+0)*@{armor_flag0})+((@{armor_ballistic1}+0)*@{armor_flag1})+((@{armor_ballistic2}+0)*@{armor_flag2})+((@{armor_ballistic3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_general_armor"
    value="((@{armor_general0}+0)*@{armor_flag0})+((@{armor_general1}+0)*@{armor_flag1})+((@{armor_general2}+0)*@{armor_flag2})+((@{armor_general3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_defense_penalty"
    value="((@{armor_defense0}+0)*@{armor_flag0})+((@{armor_defense1}+0)*@{armor_flag1})+((@{armor_defense2}+0)*@{armor_flag2})+((@{armor_defense3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_speed_penalty"
    value="((@{armor_speed0}+0)*@{armor_flag0})+((@{armor_speed1}+0)*@{armor_flag1})+((@{armor_speed2}+0)*@{armor_flag2})+((@{armor_speed3}+0)*@{armor_flag3})" />
<input type="hidden" name="attr_initiative_penalty" value="0" />
<input type="hidden" name="attr_weapon_penalty" value="0" />
<input type="hidden" name="attr_armor_penalty" value="0" />
<script type="text/worker">
  const attributes = ["intelligence", "wits", "resolve", "strength", "dexterity", "stamina", "presence", "manipulation", "composure"]
  const mentalSkills = ["academics", "computer", "investigation", "medicine", "occult", "politics", "science"]
  const physicalSkills = ["athletics", "brawl", "drive", "firearms", "larceny", "stealth", "survival", "weaponry"]
  const socialSkills = ["animalken", "empathy", "expression", "intimidation", "persuasion", "socialize", "streetwise", "subterfuge"]
  const skills = [...mentalSkills, ...physicalSkills, ...socialSkills]
  const normalStats = [...attributes, ...skills]
  const sizeStats = ["base_size", "giant", "small_framed"]
  const woundPenaltyStats = ["iron_stamina"]
  const speedStats = ["species_factor", "fleet_of_foot"]
  const defenseStats = ["defense_attr", "defense_skill", "defense_bonus"]
  const initiativeStats = ["shoot_first"]
  const allStats = [...normalStats, ...sizeStats, ...speedStats, ...defenseStats, ...initiativeStats, ...woundPenaltyStats]

  const derivedHealthStats = [...sizeStats, "stamina"]
  const derivedSpeedStats = ["dexterity","strength", ...speedStats]
  const derivedDefenseStats = ["wits", "dexterity", "athletics", "brawl", "weaponry", ...defenseStats]
  const derivedInitiativeStats = ["dexterity", "composure", "firearms", "shoot_first"]
  const derivedWillpowerStats = ["resolve", "composure"]
  const derivedWoundPenaltyStats = ["iron_stamina"]

  const maxValues = {
    'fleet_of_foot': 3,
    'iron_stamina': 3,
    'vitality': 10,
    'spite': 10
  }

  allStats.forEach((attr) => {
    on(`change:${attr}`, (eventInfo) => {
      const statUpdaters = [
        [derivedHealthStats, updateHealth],
        [derivedSpeedStats, updateSpeed],
        [derivedDefenseStats, updateDefense],
        [derivedInitiativeStats, updateInitiative],
        [derivedWillpowerStats, updateWillpower],
        [derivedWoundPenaltyStats, updateWoundPenalties],
      ]
      const source = eventInfo.sourceAttribute
      fixMaxOverflow(eventInfo)
      updateStats(statUpdaters, source)
    })
  })

  const fixMaxOverflow = (eventInfo) => {
    const source = eventInfo.sourceAttribute
    const maxValue = maxValues[source]
    if (maxValue) {
      getAttrs([source], (v) => {
        const value = parseInt(v[source])
        if (value > maxValue) {
          setAttrs({
            [source]: eventInfo.previousValue
          })
        }
      })
    }
  }

  const updateStats = (statUpdaters, source) => {
    statUpdaters.forEach(([stats, updater]) => {
      if (stats.includes(source)) {
        updater()
      }
    })
  }

  const multidotTraits = [
    'extra_trait',
    'artifact',
  ]

  const dotAttrs = [
  ...attributes,
  ...skills,
  "repeating_merit:merit",
  "spite",
  ...[...Array(8).keys()].flatMap(i => multidotTraits.map(t => `${t}_${i}`)),
  ];

  // Set hidden attr on dot button click
  dotAttrs.forEach(attr => {
    new Array(16).fill(1).forEach((_, dot) => {
        on(`clicked:${attr}-${dot}`, () => {
            setAttrs({
                [attr.replace(":","_")]: dot
            });
        });
    });
});

  const checkboxAttributes = [
    "small_framed",
    "giant",
    "shoot_first",
    "enable_profession",
    "armor_flag0",
    "armor_flag1",
    "armor_flag2",
    "armor_flag3",
    "academics_box","computer_box","crafts_box","investigation_box","medicine_box","occult_box","politics_box","science_box","athletics_box","brawl_box","drive_box","firearms_box","larceny_box","stealth_box","survival_box","weaponry_box",
    "animalken_box","empathy_box","expression_box","intimidation_box","persuasion_box","socialize_box","streetwise_box","subterfuge_box"
  ]
  checkboxAttributes.forEach((checkboxAttribute) => {
    on(`clicked:${checkboxAttribute}`, () => {
      const attr = checkboxAttribute.replace(":","_")
      getAttrs([attr], (values) => {
        const checkboxValue = ["1", "on"].includes(values[attr])
        setAttrs({
          [attr]: checkboxValue ? "0" : "1"
        })
      })
    })
  })

  const radioSeriesAttributes = ["attack"];
  radioSeriesAttributes.forEach((radioSeriesAttribute) => {
      const radioAttributes = new Array(6)
          .fill(1)
          .map((_, index) => `${radioSeriesAttribute}_${index}`);

      radioAttributes.forEach((radioAttribute) => {
          on(`clicked:${radioAttribute}`, () => {
              getAttrs([`${radioAttribute}_value`], (values) => {
                  const clearFlags = radioAttributes
                      .map((clearRadioAttribute) => `${clearRadioAttribute}_flag`)
                      .reduce((acc, flag) => ({ ...acc, [flag]: "0" }), {});
                  setAttrs({
                      [radioSeriesAttribute]: values[`${radioAttribute}_value`],
                      ...clearFlags,
                      [`${radioAttribute}_flag`]: "1"
                  });
              });
          });
      });
  });

  const currentValueSeriesAttributes = ["willpower", "vitality", "spite"]
  const currentValueAttributes = [
    ...currentValueSeriesAttributes.flatMap((currentValueSeriesAttribute) =>
        new Array(30).fill(1).map((_, i) => `${currentValueSeriesAttribute}_box${i+1}`)
      )
  ]

  currentValueAttributes.forEach((currentValueAttribute) => {
    on(`clicked:${currentValueAttribute}`, () => {
      const [attribute, value] = currentValueAttribute.split("_box")
      const attr = `current_${attribute}`
      const clickedValue = parseInt(value)
      getAttrs([attr], (v) => {
        const currentValue = parseInt(v[attr])
        const newValue = currentValue === clickedValue ? currentValue - 1 : clickedValue
        setAttrs({
          [`current_${attribute}`]: newValue
        })
      })
    })
  })

  const updateHealth = () => {
    getAttrs(["stamina","resolve","base_size","giant","small_framed"], (v) => {
      const health = Number(v.stamina) + Number(v.base_size) + Number(v.giant) - Number(v.small_framed)
      setAttrs({
        health
      })
    })
  }

  const updateSpeed = () => {
    getAttrs(["dexterity", "strength"], (v) => {
      speed = (parseInt(v.strength) || 0) + (parseInt(v.dexterity) || 0)
      setAttrs({
        speed_base: speed
      })
    })
  }

  const updateDefense = () => {
    getAttrs(["defense_attr","defense_skill","entity","athletics","brawl","dexterity","weaponry","wits"], (v) => {
      setAttrs({
        defense_base: getDefenseAttr(v) + getDefenseSkill(v)
      })
    })
  }

  const getDefenseAttr = (v) => {
    const dexterity = parseInt(v.dexterity, 10) || 0
    const wits = parseInt(v.wits, 10) || 10
    switch (v.defense_attr) {
      case "lowest":
        return Math.min(dexterity, wits)
      case "highest":
        return Math.max(dexterity, wits)
      case "wits":
        return wits
      case "dexterity":
        return dexterity
    }
  }

  const getDefenseSkill = (v) => {
    const skill = v.defense_skill
    if (skill === "nothing") {
      return 0
    }
    return parseInt(v[skill], 10) || 0
  }

  const updateInitiative = () => {
    getAttrs(["dexterity", "composure", "shoot_first", "firearms"], (v) => {
      const initiativeBase =
        (parseInt(v.dexterity) || 0) +
        (parseInt(v.composure) || 0) +
        (v.shoot_first === "1" ? (parseInt(v.firearms) || 0) : 0)
      setAttrs({
        initiative_base: initiativeBase
      })
    })
  }

  const updateWillpower = () => {
    getAttrs(["resolve", "composure", "current_willpower"], (v) => {
      const resolve = parseInt(v.resolve) || 0
      const composure = parseInt(v.composure) || 0
      const currentWillpower = parseInt(v.current_willpower) || 0
      const willpower = resolve+composure
      const newCurrentWp = currentWillpower > willpower ? willpower : currentWillpower
        setAttrs({
          willpower,
          current_willpower: newCurrentWp
        })
    })
  }

  //Health boxes
  // trait name and depth (number of distinct healthbox states)
  const healthTraits = { "healthbox": 4 };
  // Create array of all health attribute names, with values 1 through 24 for each health trait.
  const healthAttrs = Object.keys(healthTraits)
      .reduce((attrs, trait) => ({
          ...attrs,
          ...new Array(24)
              .fill(1)
              .map((_, index) => `${trait}_${index + 1}`)
              .reduce((traitAttrs, traitAttr) => ({ ...traitAttrs, [traitAttr]: healthTraits[trait] }), {})
      }), {});

  // Register button click event for each health attribute
  Object.entries(healthAttrs).forEach(([attr, depth]) => {
    on(`clicked:${attr}`, () => {
        // Increment / cycle corresponding attribute value
        getAttrs([attr], (v) => {
            const healthValue = parseInt(v[attr]) || 0
            setAttrs({
                [attr]: (healthValue + 1) % depth
            })
        })
    })
  })

  const updateWoundPenalties = () => {
    getAttrs(["iron_stamina"], (v) => {
        const ironStamina = parseInt(v.iron_stamina, 10) || 0
        const woundPenalties = getWoundPenalties(ironStamina)

        setAttrs(woundPenalties)
    })
  }

  const getWoundPenalties = (ironStamina) => {
    const maxPenalty = Math.min(ironStamina, 3) - 3
    // Whitespace instead of empty string to avoid displaying default value
    return {
        "wound_penalty_1": Math.min(maxPenalty + 2, 0) || " ",
        "wound_penalty_2": Math.min(maxPenalty + 1, 0) || " ",
        "wound_penalty_3": Math.min(maxPenalty, 0) || " "
    }
  }

  ["_initiative0","_initiative1","_initiative2","_initiative3","_initiative4","_strength0","_strength1","_strength2","_strength3","_strength4","_0_flag","_1_flag","_2_flag","_3_flag",].forEach((attr) => {
        on(`change:attack${attr}`, (eventInfo) => {
            console.log("updating attack")
            updateAttacks();
        });
    });

    ["","_flag0","_flag1","_flag2","_strength0","_strength1","_strength2"].forEach((attr) => {
        on(`change:armor${attr}`, (eventInfo) => {
            updateAttacks();
        });
    });

    on("change:health", () => {
        updateAttacks();
    });

    [...Array(16).keys()].forEach((attr) => {//healthbox nr. 1 through 16
        on(`change:healthbox_${attr+1}`, (eventInfo) => {
            const source = eventInfo.sourceAttribute;
            console.log(source);
            updateAttacks();
        });
    });

  const updateAttacks = () => {
    getAttrs(["strength","attack","iron_stamina","attack_initiative0","attack_initiative1","attack_initiative2","attack_initiative3","attack_initiative4","attack_initiative5","attack_strength0","attack_strength1","attack_strength2","attack_strength3","attack_strength4","attack_strength5","armor_flag0","armor_flag1","armor_flag2","armor_flag3","armor_strength0","armor_strength1","armor_strength2","armor_strength3","health","healthbox_1","healthbox_2","healthbox_3","healthbox_4","healthbox_5","healthbox_6","healthbox_7","healthbox_8","healthbox_9","healthbox_10","healthbox_11","healthbox_12","healthbox_13","healthbox_14","healthbox_15","healthbox_16"], (v) => {
        var str = parseInt(v.strength, 10);
        var regex = /attack_type(.)/;
        var atknum = v.attack.match(regex)[1];
        var init = isNaN(v["attack_initiative" + atknum]) === false && v["attack_initiative" + atknum] != "" ? v["attack_initiative" + atknum] : 0;
        var wpen = str < v["attack_strength" + atknum] ? str - v["attack_strength" + atknum] : 0;
        var apen = 0;
        if(v.armor_flag0 != 0 && str < parseInt(v.armor_strength0)) {apen = apen + (str - parseInt(v.armor_strength0));};
        if(v.armor_flag1 != 0 && str < parseInt(v.armor_strength1)) {apen = apen + (str - parseInt(v.armor_strength1));};
        if(v.armor_flag2 != 0 && str < parseInt(v.armor_strength2)) {apen = apen + (str - parseInt(v.armor_strength2));};
        var wound_penalty = 0;
        var ironStamina = parseInt(v.iron_stamina, 10);
        if(v["healthbox_" + v.health] != 0) {
            wound_penalty = -3 + Math.min(ironStamina, 3);
        }
        else if(v["healthbox_" + (v.health - 1)] != 0) {
            wound_penalty = -2 + Math.min(ironStamina, 2);
        }
        else if(v["healthbox_" + (v.health - 2)] != 0) {
            wound_penalty = -1 + Math.min(ironStamina, 1);
        }
        setAttrs({
            weapon_penalty: wpen,
            armor_penalty: apen,
            initiative_penalty: init,
            wound_penalty: wound_penalty
        });
    });
}


const extraTraitCount = 9;
const weaponCount = 6;
const maxTraitCount = Math.max(extraTraitCount, weaponCount)
const repeatingWeaponTraits = [
    "weapon_name_%d",
    "weapon_damage_%d",
    "weapon_range_%d",
    "weapon_clip_%d",
    "weapon_initiative_%d",
    "weapon_strength_%d",
    "weapon_size_%d",
]

const repeatingV1Attrs = [
    ...[...Array(extraTraitCount).keys()].flatMap((i) => [`other_traits_${i+1}_name`, `other_traits_${i+1}`]),
    ...[...Array(weaponCount).keys()].flatMap((i) => repeatingWeaponTraits.map((t) => t.replace("%d", i+1)))
]

const version1Attrs = ['int', 'res', 'str', 'dex', 'sta', 'pre', 'man', 'com', 'willpower_available', 'vitality_dot', 'vitality_available', 'shade', 'lament']

const v1AttrMap = {
    "int": "intelligence",
    "res": "resolve",
    "str": "strength",
    "dex": "dexterity",
    "sta": "stamina",
    "pre": "presence",
    "man": "manipulation",
    "com": "composure",
    "willpower_available": "current_willpower",
    "vitality_dot": "vitality",
    "vitality_available": "current_vitality",
    "spite_dot": "spite",
    "spite_available": "current_spite",
    'speed_defense': 'armor_speed0',
    'armor_strength': 'armor_strength0',
    'armor_defense,': 'armor_defense0',
    'armor_text': 'armor_description0',
  }

  const newV1Attr = ['iron_stamina', 'fleet_of_foot', 'shoot_first', 'giant', 'small_framed', 'defense_bonus']

  const v0ArmorAttr = ['armor_rating', 'armor_strength', 'armor_defense,', 'speed_defense', 'armor_text']

  const repeatingV1AttrMap = {
    "other_traits_%d_name": "extra_trait_%d_name",
    "other_traits_%d": "extra_trait_%d",
    "weapon_name_%d": "attack_name%d",
    "weapon_damage_%d": "attack_damage%d",
    "weapon_range_%d": "attack_range%d",
    "weapon_clip_%d": "attack_magazine%d",
    "weapon_initiative_%d": "attack_initiative%d",
    "weapon_strength_%d": "attack_strength%d",
    "weapon_size_%d": "attack_size%d"
  }

  const versionAttrs = ["version", ...version1Attrs, ...repeatingV1Attrs, ...v0ArmorAttr]

  //Upgrade for new sheet versions
  const versionUpdate = () => {
    getAttrs(versionAttrs, (v) => {
        console.log(versionAttrs,v);
        const version = parseInt(v.version) || 0
      let attrs = {}
      if (version < 1) {
        if(v.armor_rating) {
            const [ballistic, general] = v.armor_rating.split("/")
            if(ballistic) {
                attrs["armor_ballistic0"] = ballistic
            }
            if(general) {
                attrs["armor_general0"] = general || ballistic || 0
            }
        }
        //Rename v0 attributes to v1 attributes
        const renamedAttrs = Object.entries(v1AttrMap).reduce((attrs, [oldAttr, newAttr]) => ({
          ...attrs,
          [newAttr]: v[oldAttr] || ""
        }), {})
        //Initialise new attributes
        const newAttrs = newV1Attr.reduce((attrs, newAttr) => ({
          ...attrs,
          [newAttr]: 0
        }), {})
        const lamentAndShadeAttrs = {
          "shade": v.shade.toLowerCase().replace(" ", ""),
          "lament": v.lament.toLowerCase().replace(" ", ""),
        }
        const repeatingAttrs = [...Array(maxTraitCount).keys()].reduce((attrs, i) => {
            const repeatingAttrMap = Object.entries(repeatingV1AttrMap)
                .filter(([oldAttr, _]) => oldAttr.replace("%d", i+1) in v)
                .reduce((attrs, [oldAttr, newAttr]) => {
                    return{
                            ...attrs,
                            [newAttr.replace("%d", i+1)]: v[oldAttr.replace("%d", i+1)]
                    }
                }, {})
                return {
                    ...attrs,
                    ...repeatingAttrMap
                }
        }, {});
        //Set all attributes
        attrs = {
          ...attrs,
          ...renamedAttrs,
          ...newAttrs,
          ...lamentAndShadeAttrs,
          ...repeatingAttrs,
        }
        attrs["version"] = 1
      }
      console.log("Upgrading for V1:", attrs)
      setAttrs(attrs)
    })
  }

  on("sheet:opened", () => {
    versionUpdate()
    updateHealth()
    updateAttacks()
    updateSpeed()
    updateDefense()
    updateInitiative()
    updateWillpower()
  })
</script>
